(function(){"use strict";var t={8421:function(t,e,s){var a=s(5130),r=s(6768);const l={id:"app"};function i(t,e,s,a,i,n){const o=(0,r.g2)("router-view"),c=(0,r.g2)("MainLayout");return(0,r.uX)(),(0,r.CE)("div",l,[t.user?((0,r.uX)(),(0,r.Wv)(c,{key:0},{default:(0,r.k6)((()=>[(0,r.bF)(o)])),_:1})):((0,r.uX)(),(0,r.Wv)(o,{key:1}))])}s(4114);var n=s(4232);const o={class:"navbar"},c={class:"navbar-left"},u={key:0,class:"navbar-right"},d={class:"user-info"},_={key:1,class:"navbar-right"},p={class:"user-info"},h={class:"list-group"};function y(t,e,s,l,i,y){const k=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",null,[(0,r.Lk)("header",null,[(0,r.Lk)("nav",o,[(0,r.Lk)("div",c,[(0,r.Lk)("span",{class:"menu-icon",onClick:e[0]||(e[0]=(...e)=>t.toggleSidebar&&t.toggleSidebar(...e))},e[3]||(e[3]=[(0,r.Lk)("i",{class:"fas fa-bars menu-icon",style:{color:"blue"}},null,-1)])),e[4]||(e[4]=(0,r.Lk)("span",{class:"navbar-title"},"ระบบวางแผนการเรียน",-1))]),l.user&&(y.isAdmin||y.isOfficer||y.isTeacher)?((0,r.uX)(),(0,r.CE)("div",u,[(0,r.Lk)("div",d,[(0,r.Lk)("p",null,(0,n.v_)(l.user.user_name)+" "+(0,n.v_)(l.user.user_last),1),(0,r.Lk)("p",null,"Status: "+(0,n.v_)(y.getStatusLabel(l.user.user_status)),1)]),(0,r.Lk)("button",{class:"logout-button",onClick:e[1]||(e[1]=(...t)=>y.logout&&y.logout(...t))},"Log out")])):(0,r.Q3)("",!0),l.user&&y.isStudent?((0,r.uX)(),(0,r.CE)("div",_,[(0,r.Lk)("div",p,[(0,r.Lk)("p",null,(0,n.v_)(l.user.std_name)+" "+(0,n.v_)(l.user.std_last),1),(0,r.Lk)("p",null,"Status: "+(0,n.v_)(y.getStatusLabel(l.user.user_status)),1)]),(0,r.Lk)("button",{class:"logout-button",onClick:e[2]||(e[2]=(...t)=>y.logout&&y.logout(...t))},"Log out")])):(0,r.Q3)("",!0),l.user?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.Wv)(k,{key:2,to:"/loginPage"},{default:(0,r.k6)((()=>e[5]||(e[5]=[(0,r.Lk)("button",{class:"login-button"},"เข้าสู่ระบบ",-1)]))),_:1}))]),(0,r.bF)(a.eB,{name:"slide",style:{"text-align":"left"}},{default:(0,r.k6)((()=>[y.isStudent?((0,r.uX)(),(0,r.CE)("div",{key:0,class:(0,n.C4)(["sidebar",{"sidebar-active":t.isSidebarVisible}])},[(0,r.Lk)("ul",null,[(0,r.bF)(k,{to:"/"},{default:(0,r.k6)((()=>e[6]||(e[6]=[(0,r.Lk)("li",null,"หน้าหลัก",-1)]))),_:1}),(0,r.bF)(k,{to:"/student_plan"},{default:(0,r.k6)((()=>e[7]||(e[7]=[(0,r.Lk)("li",null,"แผนการเรียน",-1)]))),_:1})])],2)):(0,r.Q3)("",!0)])),_:1}),(0,r.bF)(a.eB,{name:"slide",style:{"text-align":"left"}},{default:(0,r.k6)((()=>[y.isOfficer?((0,r.uX)(),(0,r.CE)("div",{key:0,class:(0,n.C4)(["sidebar",{"sidebar-active":t.isSidebarVisible}])},[(0,r.Lk)("ul",null,[(0,r.bF)(k,{to:"/"},{default:(0,r.k6)((()=>e[8]||(e[8]=[(0,r.Lk)("li",null,"หน้าหลัก",-1)]))),_:1}),(0,r.bF)(k,{to:"/open_subject"},{default:(0,r.k6)((()=>e[9]||(e[9]=[(0,r.Lk)("li",null,"กำหนดการเปิดการสอน",-1)]))),_:1}),(0,r.bF)(k,{to:"/standard_plan"},{default:(0,r.k6)((()=>e[10]||(e[10]=[(0,r.Lk)("li",null,"จัดแผนการเรียนมาตรฐาน",-1)]))),_:1}),(0,r.bF)(k,{to:"/student_plan_list"},{default:(0,r.k6)((()=>e[11]||(e[11]=[(0,r.Lk)("li",null,"จัดแผนการเรียนรายบุคคล",-1)]))),_:1})])],2)):(0,r.Q3)("",!0)])),_:1}),(0,r.bF)(a.eB,{name:"slide",style:{"text-align":"left"}},{default:(0,r.k6)((()=>[y.isAdmin||y.isTeacher?((0,r.uX)(),(0,r.CE)("div",{key:0,class:(0,n.C4)(["sidebar",{"sidebar-active":t.isSidebarVisible}])},[(0,r.Lk)("ul",h,[(0,r.bF)(k,{to:"/"},{default:(0,r.k6)((()=>e[12]||(e[12]=[(0,r.Lk)("li",null,"หน้าหลัก",-1)]))),_:1}),(0,r.bF)(k,{to:"/open_subject"},{default:(0,r.k6)((()=>e[13]||(e[13]=[(0,r.Lk)("li",null,"กำหนดการเปิดการสอน",-1)]))),_:1}),(0,r.bF)(k,{to:"/standard_plan"},{default:(0,r.k6)((()=>e[14]||(e[14]=[(0,r.Lk)("li",null,"จัดแผนการเรียนมาตรฐาน",-1)]))),_:1}),(0,r.bF)(k,{to:"/student_plan_list"},{default:(0,r.k6)((()=>e[15]||(e[15]=[(0,r.Lk)("li",null,"จัดแผนการเรียนรายบุคคล",-1)]))),_:1}),(0,r.bF)(k,{to:"/submitplan"},{default:(0,r.k6)((()=>e[16]||(e[16]=[(0,r.Lk)("li",null,"ยืนยันแผนการเรียนรายบุคคล",-1)]))),_:1}),(0,r.bF)(k,{to:"/adjust_list"},{default:(0,r.k6)((()=>e[17]||(e[17]=[(0,r.Lk)("li",null,"อนุมัติขอปรับแผนการเรียน",-1)]))),_:1}),e[21]||(e[21]=(0,r.Lk)("label",{style:{"background-color":"#8c8c8c",padding:"2px 1px"}},null,-1)),e[22]||(e[22]=(0,r.Lk)("label",{style:{margin:"10px"}},"รายงาน",-1)),(0,r.bF)(k,{to:"/summery_student"},{default:(0,r.k6)((()=>e[18]||(e[18]=[(0,r.Lk)("li",null,"รายงานแผนการเรียนรายบุคคล",-1)]))),_:1}),(0,r.bF)(k,{to:"/summery_tranfer"},{default:(0,r.k6)((()=>e[19]||(e[19]=[(0,r.Lk)("li",null,"รายงานผลการเทียบโอน",-1)]))),_:1}),(0,r.bF)(k,{to:"/summery_plan"},{default:(0,r.k6)((()=>e[20]||(e[20]=[(0,r.Lk)("li",null,"รายงานแผนการเรียนประจำภาคเรียน",-1)]))),_:1})])],2)):(0,r.Q3)("",!0)])),_:1}),(0,r.bF)(a.eB,{name:"slide",style:{"text-align":"left"}},{default:(0,r.k6)((()=>[l.user?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",{key:0,class:(0,n.C4)(["sidebar",{"sidebar-active":t.isSidebarVisible}])},[(0,r.Lk)("ul",null,[(0,r.bF)(k,{to:"/"},{default:(0,r.k6)((()=>e[23]||(e[23]=[(0,r.Lk)("li",null,"หน้าหลัก",-1)]))),_:1})])],2))])),_:1})]),(0,r.Lk)("main",null,[(0,r.RG)(t.$slots,"default")]),e[24]||(e[24]=(0,r.Lk)("footer",null,[(0,r.Lk)("p",null,"© 2024 มหาวิทยาลัยเทคโนโลยีราชมงคลอีสาน")],-1))])}var k=s(782),b={setup(){const t=(0,k.Pj)(),e=(0,r.EW)((()=>t.state.user));return(0,r.Gt)("user",e),{user:e}},name:"MainLayout",computed:{...(0,k.aH)({user:t=>t.user,isSidebarVisible:t=>t.isSidebarVisible}),isAdmin(){return this.user&&"0"===this.user.user_status},isTeacher(){return this.user&&"1"===this.user.user_status},isOfficer(){return this.user&&"2"===this.user.user_status},isStudent(){return this.user&&"3"===this.user.user_status}},methods:{...(0,k.i0)(["clearUserData","toggleSidebar"]),logout(){confirm("ต้องการออกจากระบบหรือไม่")&&(localStorage.removeItem("user_data"),this.$store.dispatch("clearUserData"),this.$router.push("/"))},getStatusLabel(t){const e={0:"ผู้ดูแลระบบ",1:"อาจารย์ประจำหลักสูตร",2:"เจ้าหน้าที่",3:"นักศึกษา"};return e[t]||"ไม่ทราบสถานะ"}}},g=s(1241);const m=(0,g.A)(b,[["render",y]]);var f=m,L={name:"App",components:{MainLayout:f},computed:{...(0,k.aH)(["user"])},created(){this.loadUserData()},methods:{...(0,k.i0)(["setUserData","clearUserData"]),loadUserData(){const t=localStorage.getItem("user_data");t&&this.setUserData(JSON.parse(t))},logout(){this.clearUserData(),localStorage.removeItem("user_data"),this.$router.push("/")}}};const v=(0,g.A)(L,[["render",i]]);var C=v,j=(0,k.y$)({state:{user:JSON.parse(localStorage.getItem("user_data"))||null,isSidebarVisible:!1},mutations:{setUserData(t,e){t.user=e,localStorage.setItem("user_data",JSON.stringify(e))},clearUserData(t){t.user=null,localStorage.removeItem("user_data")},TOGGLE_SIDEBAR(t){t.isSidebarVisible=!t.isSidebarVisible},SHOW_SIDEBAR(t){t.isSidebarVisible=!0},HIDE_SIDEBAR(t){t.isSidebarVisible=!1}},actions:{setUserData({commit:t},e){t("setUserData",e)},clearUserData({commit:t}){t("clearUserData")},toggleSidebar({commit:t}){t("TOGGLE_SIDEBAR")},showSidebar({commit:t}){t("SHOW_SIDEBAR")},hideSidebar({commit:t}){t("HIDE_SIDEBAR")}},getters:{isAuthenticated(t){return!!t.user},getUser(t){return t.user},isSidebarVisible(t){return t.isSidebarVisible}}}),E=s(1387),w=s.p+"img/RMUTI_KORAT.765c80f0.png";const S={class:"main-content"},x={class:"tables-container",style:{display:"flex","justify-content":"space-between",gap:"20px"}},X={class:"table-container",style:{width:"50%"}},P={class:"space-y-2"},T=["onClick"],A={key:0,class:"ml-6 mt-1 space-y-1 transition-all"},Q=["onClick"],$={key:0},N={key:1},O={class:"data-table"},F={class:"data-table"},I={key:0,style:{color:"green"}},q={key:1,style:{color:"red"}},W={key:2,style:{color:"blue"}};function G(t,e,s,a,l,i){const o=(0,r.g2)("MainLayout");return(0,r.uX)(),(0,r.Wv)(o,null,{default:(0,r.k6)((()=>[(0,r.Lk)("div",S,["3"===a.user.user_status?((0,r.uX)(),(0,r.CE)(r.FK,{key:0},[e[2]||(e[2]=(0,r.Lk)("div",{class:"logo"},[(0,r.Lk)("img",{src:w,alt:"Logo",style:{height:"200px"}})],-1)),e[3]||(e[3]=(0,r.Lk)("div",{class:"table-headers",style:{display:"flex","justify-content":"space-between",width:"40%","text-align":"left","font-weight":"bold","margin-bottom":"10px","margin-left":"20px"}},[(0,r.Lk)("h2",null,"แผนการเรียน"),(0,r.Lk)("h2",null,"รายการแก้ไขแผน")],-1)),(0,r.Lk)("div",x,[(0,r.Lk)("div",X,[(0,r.Lk)("ul",P,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.structure_group,((t,e)=>((0,r.uX)(),(0,r.CE)("li",{key:e},[(0,r.Lk)("div",{onClick:t=>a.toggleCategory(e),class:"cursor-pointer font-bold flex justify-between items-center p-2 rounded-md hover:bg-gray-200 transition duration-200 w-full"},[(0,r.Lk)("span",null,(0,n.v_)(e),1),(0,r.Lk)("i",{class:(0,n.C4)([a.expandedCategories[e]?"fa-solid fa-chevron-down rotate-90":"fa-solid fa-chevron-right","transition-transform"])},null,2)],8,T),a.expandedCategories[e]?((0,r.uX)(),(0,r.CE)("ul",A,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(t,(t=>((0,r.uX)(),(0,r.CE)("li",{key:t.group_id,class:"text-gray-700 pl-2 border-l border-gray-300"},[(0,r.Lk)("div",{onClick:e=>i.fetchSubject(t.group_id),class:"cursor-pointer flex justify-between items-center p-2 rounded-md hover:bg-gray-200 transition duration-200 w-full"},[(0,r.Lk)("span",null,(0,n.v_)(t.group_id+". "+t.group_name),1)],8,Q)])))),128))])):(0,r.Q3)("",!0)])))),128))]),0==l.subject_list.length?((0,r.uX)(),(0,r.CE)("p",$,"ไม่มีข้อมูลวิชาในกลุ่มที่เลือก")):(0,r.Q3)("",!0),l.subject_list.length>0?((0,r.uX)(),(0,r.CE)("div",N,[(0,r.Lk)("table",O,[e[0]||(e[0]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",{style:{width:"140px"}},"รหัสวิชา"),(0,r.Lk)("th",{style:{width:"400px"}},"ชื่อวิชา")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(l.subject_list,(t=>((0,r.uX)(),(0,r.CE)("tr",{key:t.subject_id},[(0,r.Lk)("td",null,(0,n.v_)(t.subject_id),1),(0,r.Lk)("td",null,(0,n.v_)(t.subject_nameTh),1)])))),128))])])])):(0,r.Q3)("",!0)]),(0,r.Lk)("div",null,[(0,r.Lk)("table",F,[e[1]||(e[1]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",null,"วันที่ขอปรับ"),(0,r.Lk)("th",null,"วันที่พิจารณา"),(0,r.Lk)("th",null,"ผู้พิจารณา"),(0,r.Lk)("th",null,"สถานะ"),(0,r.Lk)("th",null,"สาเหตุ")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(l.adjust_list,(t=>((0,r.uX)(),(0,r.CE)("tr",{key:t.std_id},[(0,r.Lk)("td",null,(0,n.v_)(t.date_add),1),(0,r.Lk)("td",null,(0,n.v_)(t.date_updated||"-"),1),(0,r.Lk)("td",null,(0,n.v_)(t.user_ap||"-"),1),1==t.status?((0,r.uX)(),(0,r.CE)("td",I,(0,n.v_)(i.convertStatusToText(t.status)),1)):(0,r.Q3)("",!0),2==t.status?((0,r.uX)(),(0,r.CE)("td",q,(0,n.v_)(i.convertStatusToText(t.status)),1)):(0,r.Q3)("",!0),0==t.status?((0,r.uX)(),(0,r.CE)("td",W,(0,n.v_)(i.convertStatusToText(t.status)),1)):(0,r.Q3)("",!0),(0,r.Lk)("td",null,(0,n.v_)(t.reason||"-"),1)])))),128))])])])])],64)):((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[e[4]||(e[4]=(0,r.Lk)("div",{class:"welcome-text"},[(0,r.Lk)("h1",null,"ยินดีต้อนรับนักศึกษาทุกท่าน"),(0,r.Lk)("p",null," นี่คือระบบวางแผนการเรียนให้นักศึกษาสามารถติดตามและแก้ไขแผนการเรียนของตนเองได้ ")],-1)),e[5]||(e[5]=(0,r.Lk)("div",{class:"logo"},[(0,r.Lk)("img",{src:w,alt:"Logo"})],-1))],64))])])),_:1})}var U=s(4373),K=s(144),D={setup(){const t=(0,r.WQ)("user"),e=(0,r.EW)((()=>t?.value||{})),s=(0,K.KR)({}),a=(0,K.KR)({}),l=t=>{s.value[t]=!s.value[t]},i=t=>{a.value[t]=!a.value[t]};return console.log("User Data:",e.value),{user:e,expandedCategories:s,expandedGroups:a,toggleCategory:l,toggleGroup:i}},name:"homePage",components:{MainLayout:f},data(){return{group_list:[],subject_list:[],structure_group_subject:[],adjust_list:[]}},computed:{structure_group(){const t=this.group_list.reduce(((t,e)=>(t[e.sort]||(t[e.sort]=[]),t[e.sort].push(e),t)),{}),e=this.subject_list.reduce(((t,e)=>(t[e.group_id]||(t[e.group_id]=[]),t[e.group_id].push(e),t)),{});return Object.values(t).forEach((t=>{t.forEach((t=>{t.subjects=e[t.group_id]||[]}))})),t}},methods:{async fetchStructure(){try{const t=await U.A.get("http://127.0.0.1:3000/api/getStructure",{});this.group_list=t.data.datalist,console.log(t.data)}catch(t){console.error("Error fetching subject:",t)}},async fetchSubject(t){try{const e=await U.A.post("http://127.0.0.1:3000/api/getSubject",{group_id:t});console.log(e.data),"1"==e.data.result?this.subject_list=e.data.datalist:this.subject_list=[]}catch(e){console.error("Error fetching subject:",e)}},async fetchAdjust_list(){try{const t=await U.A.post("http://127.0.0.1:3000/api/getAdjust_list",{std_id:this.user.std_id});if("1"===t.data.result){console.log(t.data.datalist),this.adjust_list=t.data.datalist;const e=this.adjust_list.sort(((t,e)=>{const s=this.convert_date(t.date_add),a=this.convert_date(e.date_add);return a-s}));this.adjust_list=e}}catch(t){console.error("Error fetching student data:",t)}},convert_date(t){const[e,s,a]=t.split("-").map(Number),r=a-543;return new Date(r,s-1,e)},convertStatusToText(t){const e={1:"ยืนยัน",2:"ปฏิเสธ",0:"รอพิจารณา"};return e[t]||"สถานะไม่ทราบ"}},async mounted(){await this.fetchSubject(),await this.fetchAdjust_list(),await this.fetchStructure()}};const R=(0,g.A)(D,[["render",G]]);var z=R;const J={class:"login-container"},V={class:"login-box"},M={class:"form-group"},B={class:"form-group"},H={key:0,style:{color:"red"}};function Y(t,e,s,l,i,o){const c=(0,r.g2)("MainLayout");return(0,r.uX)(),(0,r.Wv)(c,null,{default:(0,r.k6)((()=>[(0,r.Lk)("div",J,[(0,r.Lk)("div",V,[e[6]||(e[6]=(0,r.Lk)("h2",null,"เข้าสู่ระบบ",-1)),(0,r.Lk)("form",{onSubmit:e[2]||(e[2]=(0,a.D$)(((...t)=>o.handleLogin&&o.handleLogin(...t)),["prevent"]))},[(0,r.Lk)("div",M,[e[3]||(e[3]=(0,r.Lk)("label",{for:"username"},"ชื่อผู้ใช้",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",id:"username","onUpdate:modelValue":e[0]||(e[0]=t=>i.username=t),placeholder:"กรอกชื่อผู้ใช้",required:""},null,512),[[a.Jo,i.username]])]),(0,r.Lk)("div",B,[e[4]||(e[4]=(0,r.Lk)("label",{for:"password"},"รหัสผ่าน",-1)),(0,r.bo)((0,r.Lk)("input",{type:"password",id:"password","onUpdate:modelValue":e[1]||(e[1]=t=>i.password=t),placeholder:"กรอกรหัสผ่าน",required:""},null,512),[[a.Jo,i.password]])]),e[5]||(e[5]=(0,r.Lk)("button",{type:"submit",class:"login-button"},"เข้าสู่ระบบ",-1))],32),i.message?((0,r.uX)(),(0,r.CE)("p",H,(0,n.v_)(i.message),1)):(0,r.Q3)("",!0)])])])),_:1})}var Z={name:"LoginPage",components:{MainLayout:f},data(){return{username:"",password:"",message:""}},created(){const t=localStorage.getItem("user_data");t&&this.setUserData(JSON.parse(t))},methods:{...(0,k.i0)(["setUserData"]),async handleLogin(){try{const t=await U.A.post("http://127.0.0.1:3000/api/getlogin",{username:this.username,password:this.password});console.log(t.data),"1"==t.data.result?(this.message=t.data.message,this.setUserData(t.data.datalist),localStorage.setItem("user_data",JSON.stringify(t.data.datalist)),this.$router.push("/")):this.message=t.data.message}catch(t){t.response?this.message=t.response.data.message:this.message="Error connecting to server."}}}};const tt=(0,g.A)(Z,[["render",Y]]);var et=tt;const st={class:"subject-table-page"},at={key:0,style:{"font-size":"24px","font-weight":"bold"}},rt={key:1,style:{"font-size":"24px","font-weight":"bold"}},lt={key:2,class:"subject-table"},it={style:{"text-align":"left",width:"370px"}},nt={key:0},ot={key:1},ct={key:2},ut=["onClick"],dt={key:3},_t={class:"dropdown-container"},pt=["value"],ht=["disabled"],yt=["value"];function kt(t,e,s,l,i,o){const c=(0,r.g2)("MainLayout");return(0,r.uX)(),(0,r.Wv)(c,null,{default:(0,r.k6)((()=>[(0,r.Lk)("div",st,[e[11]||(e[11]=(0,r.Lk)("br",null,null,-1)),e[12]||(e[12]=(0,r.Lk)("h1",null,"กำหนดการเปิดสอนรายวิชา",-1)),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>i.selectedSemester=t),style:{"font-size":"20px"}},[((0,r.uX)(),(0,r.CE)("option",{key:t.term1,value:1},"ภาคเรียนที่1")),((0,r.uX)(),(0,r.CE)("option",{key:t.term2,value:2},"ภาคเรียนที่2")),((0,r.uX)(),(0,r.CE)("option",{key:t.term,value:3},"ภาคเรียนฤดูร้อน"))],512),[[a.u1,i.selectedSemester]]),3==i.selectedSemester?((0,r.uX)(),(0,r.CE)("p",at,"รายวิชาที่เปิดสอนในภาคเรียนฤดูร้อน ")):((0,r.uX)(),(0,r.CE)("p",rt,"รายวิชาที่เปิดสอนในภาคเรียนที่ "+(0,n.v_)(i.selectedSemester),1)),i.subjects.length?((0,r.uX)(),(0,r.CE)("table",lt,[e[7]||(e[7]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",null,"รหัสวิชา"),(0,r.Lk)("th",null,"ชื่อวิชา"),(0,r.Lk)("th",null,"หน่วยกิต"),(0,r.Lk)("th",null,"กลุ่มวิชา"),(0,r.Lk)("th")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.subjects,(t=>((0,r.uX)(),(0,r.CE)("tr",{key:t.code},[(0,r.Lk)("td",null,(0,n.v_)(t.subject_id),1),(0,r.Lk)("td",it,(0,n.v_)(t.subject_name),1),t.theory_credits+t.practical_credits<3?((0,r.uX)(),(0,r.CE)("td",nt,(0,n.v_)(t.practical_credits+t.theory_credits)+"("+(0,n.v_)(t.theory_credits)+"-"+(0,n.v_)(2*t.practical_credits)+"-"+(0,n.v_)(3-(t.theory_credits+2*t.practical_credits))+") ",1)):(0,r.Q3)("",!0),t.theory_credits+t.practical_credits>=3&&t.theory_credits+t.practical_credits<=5?((0,r.uX)(),(0,r.CE)("td",ot,(0,n.v_)(t.practical_credits+t.theory_credits)+"("+(0,n.v_)(t.theory_credits)+"-"+(0,n.v_)(2*t.practical_credits)+"-"+(0,n.v_)(9-(t.theory_credits+2*t.practical_credits))+") ",1)):(0,r.Q3)("",!0),t.theory_credits+t.practical_credits==6?((0,r.uX)(),(0,r.CE)("td",ct,(0,n.v_)(t.practical_credits+t.theory_credits)+"("+(0,n.v_)(t.theory_credits)+"-"+(0,n.v_)(t.practical_credits)+"-0) ",1)):(0,r.Q3)("",!0),(0,r.Lk)("td",null,(0,n.v_)(t.group_id),1),(0,r.Lk)("td",null,[(0,r.Lk)("button",{class:"btn-remove",onClick:e=>o.del_openSubject(t.subject_id)},e[6]||(e[6]=[(0,r.Lk)("i",{class:"fa-regular fa-trash-can"},null,-1)]),8,ut)])])))),128))])])):((0,r.uX)(),(0,r.CE)("p",dt,"ไม่มีข้อมูลการเปิดสอน")),e[13]||(e[13]=(0,r.Lk)("br",null,null,-1)),(0,r.Lk)("div",_t,[(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>i.selectGroup=t),onChange:e[2]||(e[2]=(...t)=>o.fetchStructure&&o.fetchStructure(...t)),style:{"margin-right":"10px"}},[e[8]||(e[8]=(0,r.Lk)("option",{value:"",disabled:""},"เลือกกลุ่มวิชา",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.group_list,(t=>((0,r.uX)(),(0,r.CE)("option",{key:t.group_id,value:t.group_id},(0,n.v_)(t.group_id+" "+t.group_name),9,pt)))),128))],544),[[a.u1,i.selectGroup]]),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>i.selectsubject=t),onChange:e[4]||(e[4]=(...t)=>o.fetchSubject&&o.fetchSubject(...t)),style:{"margin-right":"10px"},disabled:!i.selectGroup},[e[9]||(e[9]=(0,r.Lk)("option",{value:"",disabled:""},"เลือกวิชา",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.subject_list,(t=>((0,r.uX)(),(0,r.CE)("option",{key:t.subject_id,value:t.subject_id},(0,n.v_)(t.subject_nameTh),9,yt)))),128))],40,ht),[[a.u1,i.selectsubject]]),(0,r.Lk)("button",{class:"submit-stdplan-button",style:{"font-size":"20px"},onClick:e[5]||(e[5]=(...t)=>o.addSubject&&o.addSubject(...t))},e[10]||(e[10]=[(0,r.Lk)("i",{class:"fa-solid fa-plus"},null,-1)]))]),e[14]||(e[14]=(0,r.Lk)("h4",{style:{"font-weight":"lighter"}},[(0,r.eW)(" ***หมายเหตุ หน่วยกิตที่แสดงประกอบด้วย "),(0,r.Lk)("br"),(0,r.eW)(" ผลรวมของหน่วยกิต(เวลาเรียนภาคทฤษฎี-เวลาเรียนภาคประติบัติ-เวลาเรียนนอกห้องเรียน)")],-1)),e[15]||(e[15]=(0,r.Lk)("br",null,null,-1)),e[16]||(e[16]=(0,r.Lk)("br",null,null,-1)),e[17]||(e[17]=(0,r.Lk)("br",null,null,-1))])])),_:1})}var bt={name:"tc_open_subject",components:{MainLayout:f},data(){return{subjects:[],subject_list:[],selected_course:"",course_list:[],selectedSemester:1,selectGroup:"",selectsubject:"",group_list:[],group_id:""}},methods:{async fetchSubjectlist(){if(this.selectedSemester)try{const t=await U.A.post("http://127.0.0.1:3000/api/getopensubject",{term:this.selectedSemester});"1"==t.data.result?this.subjects=t.data.datalist:"2"==t.data.result&&(this.subjects=[])}catch(t){console.error("Error fetching subjects:",t)}},async fetchSubject(){try{console.log(this.group_id);const t=await U.A.post("http://127.0.0.1:3000/api/getSubject",{group_id:this.selectGroup});console.log(t.data),"1"==t.data.result&&(this.subject_list=t.data.datalist)}catch(t){console.error("Error fetching subject:",t)}},async fetchStructure(){try{const t=await U.A.get("http://127.0.0.1:3000/api/getStructure",{});this.group_list=t.data.datalist}catch(t){console.error("Error fetching subject:",t)}},async addSubject(t){if(confirm("ต้องการจะเพิ่มวิชานี้หรือไม่"))try{console.log("Subject ID ที่ส่งมา:",t);const e=await U.A.post("http://127.0.0.1:3000/api/setOpensubject",{term:this.selectedSemester,subject_id:this.selectsubject,group_id:this.selectGroup});if(console.log(e.data),"1"===e.data.result){const t=await U.A.post("http://127.0.0.1:3000/api/getopensubject",{open_id:this.selectedOpen_id,term:this.selectedSemester});"1"===t.data.result&&(this.subjects=t.data.datalist)}else"2"===e.data.result?alert("ไม่สามารถเพิ่มวิชาได้! มีข้อมูลชุดนี้อยู่แล้ว"):alert("ไม่สามารถเพิ่มวิชาได้!")}catch(e){console.error("Error adding subject:",e)}},async del_openSubject(t){if(confirm("ต้องการนำข้อมูลชุดนี้ออกหรือไม่"))try{const e=await U.A.post("http://127.0.0.1:3000/api/drop_open",{term:this.selectedSemester,subject_id:t});if(console.log(e.data),"1"===e.data.result){const t=await U.A.post("http://127.0.0.1:3000/api/getopensubject",{open_id:this.selectedOpen_id,term:this.selectedSemester});"1"===t.data.result?this.subjects=t.data.datalist:"2"===t.data.result&&(this.subjects=[])}else alert("ไม่สามารถลบข้อมูลได้")}catch(e){console.error("Error adding subject:",e)}}},watch:{selectedSemester(t){console.log("Group ID changed:",t),this.fetchSubjectlist()},selectGroup(t){console.log("Group ID changed:",t),this.fetchSubject()}},mounted(){this.fetchSubjectlist(),this.fetchSubject(),this.fetchStructure()}};const gt=(0,g.A)(bt,[["render",kt]]);var mt=gt;const ft={class:"question-form"},Lt={class:"form-group"},vt={key:0,class:"invalid-feedback"},Ct={class:"form-group"},jt={key:0,class:"invalid-feedback"};function Et(t,e,s,l,i,o){const c=(0,r.g2)("MainLayout");return(0,r.uX)(),(0,r.Wv)(c,null,{default:(0,r.k6)((()=>[(0,r.Lk)("div",ft,[e[6]||(e[6]=(0,r.Lk)("h2",null,"เพิ่มคำถามและคำตอบ",-1)),(0,r.Lk)("div",Lt,[e[4]||(e[4]=(0,r.Lk)("label",{for:"question"},"คำถาม:",-1)),(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>i.question=t),id:"question",type:"text",placeholder:"กรอกคำถาม",class:(0,n.C4)(["form-control",{"is-invalid":i.questionError}])},null,2),[[a.Jo,i.question]]),i.questionError?((0,r.uX)(),(0,r.CE)("div",vt,(0,n.v_)(i.questionError),1)):(0,r.Q3)("",!0)]),(0,r.Lk)("button",{onClick:e[1]||(e[1]=(...t)=>o.addQuestion&&o.addQuestion(...t)),class:"btn btn-primary"},"เพิ่มคำถาม"),e[7]||(e[7]=(0,r.Lk)("br",null,null,-1)),e[8]||(e[8]=(0,r.eW)()),e[9]||(e[9]=(0,r.Lk)("br",null,null,-1)),(0,r.Lk)("div",Ct,[e[5]||(e[5]=(0,r.Lk)("label",{for:"answer"},"คำตอบ:",-1)),(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>i.answer=t),id:"answer",type:"text",placeholder:"กรอกคำตอบ",class:(0,n.C4)(["form-control",{"is-invalid":i.answerError}])},null,2),[[a.Jo,i.answer]]),i.answerError?((0,r.uX)(),(0,r.CE)("div",jt,(0,n.v_)(i.answerError),1)):(0,r.Q3)("",!0)]),(0,r.Lk)("button",{onClick:e[3]||(e[3]=(...t)=>o.addAnswer&&o.addAnswer(...t)),class:"btn btn-primary"},"เพิ่มคำตอบ")])])),_:1})}var wt={name:"tc_adddata_bot",components:{MainLayout:f},data(){return{question:"",answer:"",questionError:"",answerError:""}},methods:{async addQuestion(){if(this.question){this.questionError="";try{const t=await U.A.post("http://127.0.0.1:3000/api/setQuestion",{question:this.question});console.log(t.data),"1"===t.data.result?(alert("เพิ่มคำถามเรียบร้อยแล้ว"),this.question=""):this.questionError=t.data.message||"ไม่สามารถเพิ่มคำถามได้"}catch(t){this.questionError=t.response?.data?.message||"เกิดข้อผิดพลาดในการเชื่อมต่อ"}}else this.questionError="กรุณากรอกคำถาม"},async addAnswer(){if(this.answer){this.answerError="";try{const t=await U.A.post("http://127.0.0.1:3000/api/setAnswer",{answer:this.answer});console.log(t.data),"1"===t.data.result?(alert("เพิ่มคำตอบเรียบร้อยแล้ว"),this.answer=""):this.answerError=t.data.message||"ไม่สามารถเพิ่มคำตอบได้"}catch(t){this.answerError=t.response?.data?.message||"เกิดข้อผิดพลาดในการเชื่อมต่อ"}}else this.answerError="กรุณากรอกคำตอบ"}}};const St=(0,g.A)(wt,[["render",Et]]);var xt=St;const Xt={class:"form-container"},Pt=["value"],Tt={class:"data-stdplan-table",style:{width:"800px","margin-left":"auto","margin-right":"auto"}},At={style:{width:"400px","text-align":"left"}},Qt={style:{width:"400px"}},$t={class:"btn-group"},Nt=["onClick"],Ot={class:"dropdown-container",style:{width:"700px","margin-left":"auto","margin-right":"auto"}};function Ft(t,e,s,l,i,o){const c=(0,r.g2)("MainLayout");return(0,r.uX)(),(0,r.Wv)(c,null,{default:(0,r.k6)((()=>[(0,r.Lk)("div",Xt,[e[7]||(e[7]=(0,r.Lk)("h1",null,"จัดแผนการเรียนมาตรฐาน",-1)),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>i.select_year=t),style:{"font-size":"20px"}},[e[4]||(e[4]=(0,r.Lk)("option",{value:"",disabled:""},"เลือกรุ่นปีการศึกษา",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.year,(t=>((0,r.uX)(),(0,r.CE)("option",{key:t,value:t},(0,n.v_)(t),9,Pt)))),128))],512),[[a.u1,i.select_year]]),(0,r.Lk)("table",Tt,[e[6]||(e[6]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",null,"ชื่อแผนการเรียน"),(0,r.Lk)("th",null,"รุ่นปี"),(0,r.Lk)("th")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.plans_list,((t,s)=>((0,r.uX)(),(0,r.CE)("tr",{key:s},[(0,r.Lk)("td",At,(0,n.v_)(t.plan_id),1),(0,r.Lk)("td",Qt,(0,n.v_)(t.batch_year),1),(0,r.Lk)("td",null,[(0,r.Lk)("div",$t,[(0,r.Lk)("button",{class:"btn-add",onClick:e=>o.editPlan(t.plan_id,t.batch_year),style:{width:"100px"}},e[5]||(e[5]=[(0,r.Lk)("i",{class:"fa-solid fa-magnifying-glass"},null,-1)]),8,Nt)])])])))),128))])]),e[8]||(e[8]=(0,r.Lk)("br",null,null,-1)),(0,r.Lk)("div",Ot,[(0,r.bo)((0,r.Lk)("input",{type:"text",id:"plan_id",style:{"font-size":"16px","margin-right":"10px"},"onUpdate:modelValue":e[1]||(e[1]=t=>i.plan_id=t),placeholder:"ระบุชื่อแผนการเรียน",required:""},null,512),[[a.Jo,i.plan_id]]),(0,r.bo)((0,r.Lk)("input",{type:"text",id:"batch_year",style:{"font-size":"16px","margin-right":"10px"},"onUpdate:modelValue":e[2]||(e[2]=t=>i.batch_year=t),placeholder:"ระบุรุ่นปีการศึกษา",required:""},null,512),[[a.Jo,i.batch_year]]),(0,r.Lk)("button",{type:"submit",class:"submit-stdplan-button",style:{"font-size":"18px","margin-left":"auto","margin-right":"auto",display:"block",padding:"10px 30px"},onClick:e[3]||(e[3]=(...t)=>o.addPlan&&o.addPlan(...t))}," เพิ่ม ")])])])),_:1})}s(7642),s(8004),s(3853),s(5876),s(2475),s(5024),s(1698);var It={name:"tc_standard_plan",components:{MainLayout:f},data(){return{plan_id:"",batch_year:"",dataList:[],year:[],select_year:"",plans_list:[]}},methods:{async fetchStandardPlan(){try{const t=await U.A.get("http://127.0.0.1:3000/api/getStandard_plan",{});this.dataList=t.data.datalist,this.extract_year()}catch(t){console.error("Error fetching subject:",t)}},extract_year(){const t=this.dataList.map((t=>t.batch_year));this.year=[...new Set(t)].sort(((t,e)=>e-t))},extract_plans_by_year(){const t=this.dataList.filter((t=>t.batch_year===this.select_year));this.plans_list=t},async addPlan(){if(confirm("ต้องการที่จะเพิ่มข้อมูลหรือไม่")){if(""===this.plan_id||""===this.batch_year)return void alert("กรุณากรอกข้อมูลให้ครบถ้วน!");try{const t=await U.A.post("http://127.0.0.1:3000/api/setStandard_plan",{plan_id:this.plan_id,batch_year:this.batch_year});if(console.log(t.data),"1"===t.data.result){const t=await U.A.get("http://127.0.0.1:3000/api/getStandard_plan",{});this.dataList=t.data.datalist,this.$router.push({name:"tc_editStandard_plan",query:{plan_id:this.plan_id,batch_year:this.batch_year}})}else alert("มีข้อมูลแผนการเรียนนี้อยู่แล้ว!")}catch(t){console.error("Error adding subject:",t)}}},async editPlan(t,e){this.$router.push({name:"tc_editStandard_plan",query:{plan_id:t,batch_year:e}})}},watch:{select_year(t){console.log("Selected year:",t),this.extract_plans_by_year()}},mounted(){this.fetchStandardPlan()}};const qt=(0,g.A)(It,[["render",Ft]]);var Wt=qt;const Gt={class:"form-container"},Ut={key:0,class:"popup-overlay"},Kt={class:"popup-content"},Dt={class:"dropdown-container",style:{width:"600px"}},Rt={key:0},zt={class:"subject-table"},Jt={style:{"text-align":"left"}},Vt={key:0},Mt={key:1},Bt={key:2},Ht={key:3},Yt={class:"btn-group",style:{gap:"5px"}},Zt=["onClick"],te=["onClick"],ee={class:"dropdown-container"},se=["disabled"],ae=["value"],re=["disabled"],le=["value"],ie=["disabled"],ne={key:0},oe=["onClick","disabled"],ce={class:"btn-group",style:{"margin-bottom":"20px"}},ue={class:"btn-group"};function de(t,e,s,l,i,o){const c=(0,r.g2)("MainLayout");return(0,r.uX)(),(0,r.Wv)(c,null,{default:(0,r.k6)((()=>[(0,r.Lk)("div",Gt,[e[30]||(e[30]=(0,r.Lk)("h1",null,"จัดแผนการเรียนมาตรฐาน",-1)),(0,r.Lk)("h2",null,"ชื่อแผนการเรียน: "+(0,n.v_)(i.plan_id)+" รุ่นปี: "+(0,n.v_)(i.batch_year),1),i.change_popup?((0,r.uX)(),(0,r.CE)("div",Ut,[(0,r.Lk)("div",Kt,[(0,r.Lk)("h3",null,"ย้ายรายวิชา "+(0,n.v_)(i.sub_name)+" ไป",1),(0,r.Lk)("div",Dt,[(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>i.select_year=t),id:"year"},e[14]||(e[14]=[(0,r.Lk)("option",{value:"",disabled:""},"เลือกปี",-1),(0,r.Lk)("option",{value:"3"},"ปี 3",-1),(0,r.Lk)("option",{value:"4"},"ปี 4",-1)]),512),[[a.u1,i.select_year]]),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>i.select_term=t),id:"term"},[e[15]||(e[15]=(0,r.Lk)("option",{value:"",disabled:""},"เลือกเทอม",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.open_subject,(t=>((0,r.uX)(),(0,r.CE)(r.FK,{key:t.subject_id},[t.subject_id===i.sub_id?((0,r.uX)(),(0,r.CE)("option",Rt,(0,n.v_)(t.term),1)):(0,r.Q3)("",!0)],64)))),128))],512),[[a.u1,i.select_term]])]),(0,r.Lk)("button",{class:"btn-remove",style:{"font-size":"18px","background-color":"#00ff00","margin-right":"10px"},onClick:e[2]||(e[2]=(...t)=>o.update_plan&&o.update_plan(...t))},"ยืนยัน"),(0,r.Lk)("button",{class:"btn-remove",style:{"font-size":"18px","background-color":"#a3a3a3"},onClick:e[3]||(e[3]=(...t)=>o.closePopup&&o.closePopup(...t))},"ยกเลิก")])])):(0,r.Q3)("",!0),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.groupedPlan,(t=>((0,r.uX)(),(0,r.CE)("div",{key:t.yearTerm,class:"grouped-table"},[(0,r.Lk)("h3",null,"ภาคเรียนที่ "+(0,n.v_)(t.term)+" ปีการศึกษา "+(0,n.v_)(4===t.year?Number(i.batch_year)+1:i.batch_year),1),(0,r.Lk)("table",zt,[e[20]||(e[20]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",{style:{width:"120px"}},"รหัสวิชา"),(0,r.Lk)("th",{style:{width:"450px"}},"ชื่อวิชา"),(0,r.Lk)("th",null,"หน่วยกิต"),(0,r.Lk)("th",null,"กลุ่มวิชา"),(0,r.Lk)("th")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(t.plans,(s=>((0,r.uX)(),(0,r.CE)("tr",{key:s.code},[(0,r.Lk)("td",null,(0,n.v_)(s.subject_id),1),(0,r.Lk)("td",Jt,(0,n.v_)(s.subject_name),1),s.theory_credits+s.practical_credits<3?((0,r.uX)(),(0,r.CE)("td",Vt,(0,n.v_)(s.practical_credits+s.theory_credits)+"("+(0,n.v_)(s.theory_credits)+"-"+(0,n.v_)(2*s.practical_credits)+"-"+(0,n.v_)(3-(s.theory_credits+2*s.practical_credits))+") ",1)):(0,r.Q3)("",!0),s.theory_credits+s.practical_credits>=3&&s.theory_credits+s.practical_credits<=5?((0,r.uX)(),(0,r.CE)("td",Mt,(0,n.v_)(s.practical_credits+s.theory_credits)+"("+(0,n.v_)(s.theory_credits)+"-"+(0,n.v_)(2*s.practical_credits)+"-"+(0,n.v_)(9-(s.theory_credits+2*s.practical_credits))+") ",1)):(0,r.Q3)("",!0),s.theory_credits+s.practical_credits==6?((0,r.uX)(),(0,r.CE)("td",Bt,(0,n.v_)(s.practical_credits+s.theory_credits)+"("+(0,n.v_)(s.theory_credits)+"-"+(0,n.v_)(s.practical_credits)+"-0) ",1)):(0,r.Q3)("",!0),s.group_id?((0,r.uX)(),(0,r.CE)("td",Ht,(0,n.v_)(s.group_id),1)):(0,r.Q3)("",!0),(0,r.Lk)("td",null,[(0,r.Lk)("div",Yt,[(0,r.Lk)("button",{class:"btn-remove",onClick:t=>o.openChangePopup(s.subject_name,s.subject_id),style:{"background-color":"#00ccff","margin-right":"10px"}},e[16]||(e[16]=[(0,r.Lk)("i",{class:"fa-solid fa-repeat"},null,-1)]),8,Zt),(0,r.Lk)("button",{class:"btn-remove",onClick:e=>o.del_Subject(s.subject_id,t.term,t.year)},e[17]||(e[17]=[(0,r.Lk)("i",{class:"fa-regular fa-trash-can"},null,-1)]),8,te)])])])))),128)),(0,r.Lk)("tr",null,[e[18]||(e[18]=(0,r.Lk)("td",{colspan:"2",style:{"text-align":"right"}},"รวมหน่วยกิต:",-1)),(0,r.Lk)("td",null,(0,n.v_)(t.totalCredits),1),e[19]||(e[19]=(0,r.Lk)("td",{colspan:"2"},null,-1))])])]),e[25]||(e[25]=(0,r.Lk)("br",null,null,-1)),(0,r.Lk)("div",ee,[(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>i.selectGroup=t),onChange:e[5]||(e[5]=(...t)=>o.fetchStructure&&o.fetchStructure(...t)),style:{"margin-right":"10px"},disabled:t.totalCredits>=22&&i.spacialTerm},[e[21]||(e[21]=(0,r.Lk)("option",{value:"",disabled:""},"เลือกกลุ่มวิชา",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.filteredGroups(t.term),(t=>((0,r.uX)(),(0,r.CE)("option",{key:t.group_id,value:t.group_id},(0,n.v_)(t.group_id+" "+t.group_name),9,ae)))),128))],40,se),[[a.u1,i.selectGroup]]),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":e[6]||(e[6]=t=>i.selectsubject=t),onChange:e[7]||(e[7]=(...t)=>o.fetchOpen_subject&&o.fetchOpen_subject(...t)),style:{"margin-right":"10px"},disabled:!i.selectGroup||t.totalCredits>=22&&i.spacialTerm},[e[22]||(e[22]=(0,r.Lk)("option",{value:"",disabled:""},"เลือกวิชา",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(t.open,(t=>((0,r.uX)(),(0,r.CE)(r.FK,{key:t.subject_id},[i.selectGroup==t.group_id?((0,r.uX)(),(0,r.CE)("option",{key:0,value:t.subject_id},(0,n.v_)(t.subject_name),9,le)):(0,r.Q3)("",!0)],64)))),128))],40,re),[[a.u1,i.selectsubject]]),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":e[8]||(e[8]=t=>i.selectGroup_id=t),onChange:e[9]||(e[9]=(...t)=>o.fetchSubject&&o.fetchSubject(...t)),style:{width:"150px","margin-right":"10px"},disabled:!i.selectsubject||t.totalCredits>=22&&1==i.spacialTerm},[e[23]||(e[23]=(0,r.Lk)("option",{value:"",disabled:""},"กลุ่มวิชา",-1)),(0,r.Lk)("option",null,(0,n.v_)(i.selectGroup),1),2.2!=i.selectGroup?((0,r.uX)(),(0,r.CE)("option",ne," 3.1")):(0,r.Q3)("",!0)],40,ie),[[a.u1,i.selectGroup_id]]),t.totalCredits<25&&0==i.spacialTerm||!(t.totalCredits>=22&&1==i.spacialTerm)?((0,r.uX)(),(0,r.CE)("button",{key:0,type:"submit",class:"submit-stdplan-button",style:{"font-size":"20px"},onClick:e=>o.addSubject(t.term,t.year,t),disabled:!i.selectGroup_id},e[24]||(e[24]=[(0,r.Lk)("i",{class:"fa-solid fa-plus"},null,-1)]),8,oe)):(0,r.Q3)("",!0)])])))),128)),(0,r.Lk)("h3",null,"หน่วยกิตรวมในแผน: "+(0,n.v_)(o.totalAllCredits),1),(0,r.Lk)("div",ce,[(0,r.Lk)("button",{class:"btn-back",onClick:e[10]||(e[10]=t=>o.del_StandardPlan(i.plan_id,i.batch_year)),style:{"background-color":"red"}},e[26]||(e[26]=[(0,r.Lk)("i",{class:"fa-regular fa-trash-can"}," ลบแผน",-1)])),(0,r.Lk)("button",{class:"btn-back",style:{"background-color":"#3385ff"},onClick:e[11]||(e[11]=(...t)=>o.resetChanges&&o.resetChanges(...t))},e[27]||(e[27]=[(0,r.Lk)("i",{class:"fa-solid fa-arrow-rotate-left"}," รีเซ็ตแผน",-1)])),(0,r.Lk)("button",{class:"btn-back",onClick:e[12]||(e[12]=(...t)=>o.saveChanges&&o.saveChanges(...t)),style:{"background-color":"#33cc33"}},e[28]||(e[28]=[(0,r.Lk)("i",{class:"fa-solid fa-floppy-disk"}," บันทึกแผน",-1)]))]),(0,r.Lk)("div",ue,[(0,r.Lk)("button",{class:"btn-back",style:{"font-size":"20px"},onClick:e[13]||(e[13]=(...t)=>o.goBack&&o.goBack(...t))},e[29]||(e[29]=[(0,r.Lk)("i",{class:"fa-solid fa-arrow-left-long"}," กลับ",-1)]))]),e[31]||(e[31]=(0,r.Lk)("h4",{style:{"font-weight":"lighter","margin-bottom":"100px"}},[(0,r.eW)(" ***หมายเหตุ หน่วยกิตที่แสดงประกอบด้วย "),(0,r.Lk)("br"),(0,r.eW)(" ผลรวมของหน่วยกิต(เวลาเรียนภาคทฤษฎี-เวลาเรียนภาคประติบัติ-เวลาเรียนนอกห้องเรียน)")],-1))])])),_:1})}var _e={name:"tc_editStandard_plan",components:{MainLayout:f},data(){return{plan_id:this.$route.query.plan_id,batch_year:this.$route.query.batch_year,subjects:[],data_list:[],open_list:[],groupedPlan:[],subject_list:[],group_list:[],selectGroup:"",selectsubject:"",selectGroup_id:"",spacialTerm:!1,open_subject:[],temp_standrad_list:[],change_popup:!1,sub_name:"",sub_id:"",select_term:"",select_year:"",sort_open_list:[]}},computed:{calculateTotalCredits(){return t=>t.reduce(((t,e)=>{const s=e.theory_credits+e.practical_credits;return t+s}),0)},totalAllCredits(){return this.groupedPlan.reduce(((t,e)=>t+e.totalCredits),0)},filteredGroups(){return t=>("ภาคฤดูร้อน"==t&&(t=3),this.group_list.filter((e=>this.sort_open_list.some((s=>s.group_id===e.group_id&&s.term==t)))))}},methods:{openChangePopup(t,e){this.sub_name=t,this.sub_id=e,this.change_popup=!0},closePopup(){this.change_popup=!1},goBack(){const t=this.data_list,e=this.temp_standrad_list;JSON.stringify(t)!==JSON.stringify(e)?confirm("คุณไม่ได้บันทึกข้อมูล ต้องการกลับหรือไม่?")&&this.$router.push("/standard_plan"):this.$router.push("/standard_plan")},async fetchOpen_subject(){console.log(this.selectGroup);try{const t=await U.A.post("http://127.0.0.1:3000/api/getopensubject",{});"1"==t.data.result?(this.open_subject=t.data.datalist,this.sort_openlist(),this.groupPlans()):"2"==t.data.result&&(this.open_subject=[],this.sort_openlist(),this.groupPlans())}catch(t){console.error("Error fetching subject:",t)}},async fetchStandard_list(){try{const t=await U.A.post("http://127.0.0.1:3000/api/getStandard_list",{plan_id:this.plan_id});"1"==t.data.result?(console.log(t.data.datalist),this.data_list=t.data.datalist,this.temp_standrad_list=JSON.parse(JSON.stringify(this.data_list)),this.sort_openlist(),this.groupPlans()):"2"==t.data.result&&(this.data_list=[],this.sort_openlist(),this.groupPlans())}catch(t){console.error("Error fetching subject:",t)}},async fetchStructure(){try{const t=await U.A.get("http://127.0.0.1:3000/api/getStructure",{});this.group_list=t.data.datalist}catch(t){console.error("Error fetching subject:",t)}},async fetchSubject(){try{if(!this.selectGroup)return void(this.subject_list=[]);const t=await U.A.post("http://127.0.0.1:3000/api/getSubject",{group_id:this.selectGroup});"1"==t.data.result?this.subject_list=t.data.datalist:alert("ไม่มีข้อมูลวิชาในกลุ่มที่เลือก")}catch(t){console.error("Error fetching subject:",t)}},sort_openlist(){this.sort_open_list=this.open_subject.filter((t=>!this.temp_standrad_list.some((e=>e.subject_id===t.subject_id))))},async addSubject(t,e,s){let a=this.calculateTotalCredits(s.plans),r=this.open_subject.find((t=>t.subject_id===String(this.selectsubject))),l=this.temp_standrad_list.find((t=>t.subject_id===String(this.selectsubject)));if(l)return void alert("ไม่สามารถเพิ่มวิชาซ้ำได้");let i=Number(r.practical_credits),n=Number(r.theory_credits),o=a+i,c=a+n;if(confirm("ต้องการเพิ่มวิชานี้หรือไม่")){if(o>25||c>25)return void alert("ไม่สามารถเพิ่มได้ เนื่องจากหน่วยกิตรวมเกิน 25");if((o>22||c>22)&&1==this.spacialTerm)return void alert("ไม่สามารถเพิ่มได้ เนื่องจากมีเทอมที่หน่วยกิตเกิน 25 แล้ว");if((o>22||c>22)&&!confirm("หน่วยกิตเกิน 22 ต้องการดำเนินการต่อหรือไม่?"))return;"ภาคฤดูร้อน"==t&&(t=3);const s={group_id:this.selectGroup_id,subject_id:r.subject_id,term:t,year:e,practical_credits:r.practical_credits,theory_credits:r.theory_credits,subject_name:r.subject_name};this.temp_standrad_list.push(s),this.sort_openlist(),this.groupPlans()}},update_plan(){let t=this.temp_standrad_list.filter((t=>t.year===Number(this.select_year)&&t.term===Number(this.select_term)));console.log("Filtered Plans:",t);let e=t.reduce(((t,e)=>t+Number(e.practical_credits||0)),0),s=t.reduce(((t,e)=>t+Number(e.theory_credits||0)),0),a=this.open_subject.find((t=>t.subject_id===String(this.sub_id)));if(!a)return void alert("ไม่พบวิชาที่เลือก กรุณาลองใหม่");let r=Number(a.practical_credits),l=Number(a.theory_credits),i=e+s,n=i+r,o=i+l;if(console.log(`New Practical Credits: ${n}, New Theory Credits: ${o}`),confirm("ต้องการที่จะย้ายวิชานี้ใช่หรือไม่")){if(n>25||o>25)return void alert("ไม่สามารถเพิ่มได้ เนื่องจากหน่วยกิตรวมเกิน 25");if((n>=22||o>22)&&!confirm("หน่วยกิตในเทอมเกิน 22 ต้องการดำเนินการต่อหรือไม่?"))return;let t=this.temp_standrad_list.find((t=>t.subject_id===this.sub_id));t?(t.year=Number(this.select_year),t.term=Number(this.select_term),t.hasChanged=!0,console.log("อัปเดตข้อมูลใน temp_planlist สำเร็จ"),this.change_popup=!1):alert("ไม่พบรายวิชานี้ในแผนการเรียน"),this.sort_openlist(),this.groupPlans()}},async del_Subject(t,e,s){"ภาคฤดูร้อน"==e&&(e=3),confirm("คุณต้องการลบวิชานี้หรือไม่?")&&(this.temp_standrad_list=this.temp_standrad_list.filter((s=>!(s.subject_id===t&&s.term===e))),this.sort_openlist(),this.groupPlans(),console.log(`ลบข้อมูลที่มี subject_id=${t}, year=${s}, term=${e} สำเร็จ`))},resetChanges(){this.temp_standrad_list=JSON.parse(JSON.stringify(this.data_list)),this.sort_openlist(),this.groupPlans(),alert("รีเซ็ตข้อมูลเรียบร้อยแล้ว!")},async saveChanges(){const t=this.data_list,e=this.temp_standrad_list;if(JSON.stringify(t)!==JSON.stringify(e)){if(confirm("คุณต้องการบันทึกการเปลี่ยนแปลงหรือไม่?"))try{let t=Array.isArray(this.temp_standrad_list)?this.temp_standrad_list:[this.temp_standrad_list];console.log("planData:",t);const e=await U.A.post("http://127.0.0.1:3000/api/setStandard_list",{plan_id:this.plan_id,plans:t});"1"===e.data.result?(alert("บันทึกสำเร็จ!"),this.data_list=JSON.parse(JSON.stringify(this.temp_standrad_list)),this.$router.push("/standard_plan")):alert("เกิดข้อผิดพลาดในการบันทึกข้อมูล")}catch(s){console.error("Error saving changes:",s)}}else alert("ไม่มีการเปลี่ยนแปลงข้อมูล")},async del_StandardPlan(){if(confirm("ต้องการลบข้อมูลชุดนี้ใช่หรือไม่"))try{const t=await U.A.post("http://127.0.0.1:3000/api/dropStandard_plan",{plan_id:this.plan_id,batch_year:this.batch_year});console.log(t.data),"1"===t.data.result?(alert("ลบข้อมูลสำเร็จ!"),this.$router.push("/standard_plan")):alert("ไม่สามารถลบข้อมูลได้")}catch(t){console.error("Error adding subject:",t)}},groupPlans(){this.spacialTerm=!1;const t=[[3,1],[3,2],[3,3],[4,1],[4,2]];this.groupedPlan=t.map((([t,e])=>{const s=this.temp_standrad_list.filter((s=>s.year===t&&s.term===e)),a=s.reduce(((t,e)=>(t+(e.theory_credits+e.practical_credits)>22&&(this.spacialTerm=!0),t+(e.theory_credits+e.practical_credits))),0);return console.log(this.spacialTerm),{yearTerm:`${t}-${e}`,year:t,term:3===e?"ภาคฤดูร้อน":e,plans:this.temp_standrad_list.filter((s=>s.year===t&&s.term===e)),totalCredits:a,open:this.sort_open_list.filter((t=>t.term===e))}}))}},watch:{selectGroup(t){console.log("Group ID changed:",t),this.selectGroup_id=t,this.fetchOpen_subject(),this.selectsubject="",this.groupPlans()}},mounted(){console.log("Plan ID:",this.plan_id),console.log("Batch Year:",this.batch_year),console.log(this.spacialTerm),this.fetchStandard_list(),this.fetchOpen_subject(),this.fetchStructure(),this.fetchSubject()}};const pe=(0,g.A)(_e,[["render",de]]);var he=pe;const ye={class:"form-container"},ke={class:"dropdown-container"},be=["value"],ge=["disabled"],me={key:0,class:"student-table"},fe={style:{"text-align":"left"}},Le={key:0,style:{color:"green"}},ve={key:1,style:{color:"red"}},Ce={key:2,style:{color:"orange"}},je={key:3,style:{color:"red"}},Ee={key:4,style:{color:"blue"}},we=["onClick"],Se=["onClick"],xe={key:1};function Xe(t,e,s,l,i,o){const c=(0,r.g2)("MainLayout");return(0,r.uX)(),(0,r.Wv)(c,null,{default:(0,r.k6)((()=>[(0,r.Lk)("div",ye,[e[6]||(e[6]=(0,r.Lk)("h1",null,"จัดแผนการเรียนรายบุคคล",-1)),(0,r.Lk)("div",ke,[(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>i.select_year=t),style:{"font-size":"20px"}},[e[2]||(e[2]=(0,r.Lk)("option",{value:"",disabled:""},"เลือกรุ่นปีการศึกษา",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.year,(t=>((0,r.uX)(),(0,r.CE)("option",{key:t,value:t},(0,n.v_)(t),9,be)))),128))],512),[[a.u1,i.select_year]]),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>i.select_status=t),style:{"font-size":"20px"},disabled:!i.select_year},e[3]||(e[3]=[(0,r.Lk)("option",{value:""},"ทั้งหมด",-1),(0,r.Lk)("option",{value:"0"},"รอจัดแผนการเรียน",-1),(0,r.Lk)("option",{value:"1"},"ยืนยัน",-1),(0,r.Lk)("option",{value:"2"},"แก้ไข",-1),(0,r.Lk)("option",{value:"3"},"รอการยืนยัน",-1),(0,r.Lk)("option",{value:"4"},"ไม่สมบูรณ์",-1)]),8,ge),[[a.u1,i.select_status]])]),e[7]||(e[7]=(0,r.Lk)("h2",null,"ตารางรายชื่อนักศึกษา",-1)),i.student_data.length?((0,r.uX)(),(0,r.CE)("table",me,[e[4]||(e[4]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",null,"รหัสนักศึกษา"),(0,r.Lk)("th",null,"ชื่อ"),(0,r.Lk)("th",null,"รุ่นปี"),(0,r.Lk)("th",null,"สถานะ"),(0,r.Lk)("th")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.sortedStudents,(t=>((0,r.uX)(),(0,r.CE)("tr",{key:t.std_id},[(0,r.Lk)("td",null,(0,n.v_)(t.std_id),1),(0,r.Lk)("td",fe,(0,n.v_)(t.std_name)+" "+(0,n.v_)(t.std_last),1),(0,r.Lk)("td",null,(0,n.v_)(t.batch_year),1),1==t.status?((0,r.uX)(),(0,r.CE)("td",Le,(0,n.v_)(o.convertStatusToText(t.status)),1)):(0,r.Q3)("",!0),2==t.status?((0,r.uX)(),(0,r.CE)("td",ve,(0,n.v_)(o.convertStatusToText(t.status)),1)):(0,r.Q3)("",!0),3==t.status?((0,r.uX)(),(0,r.CE)("td",Ce,(0,n.v_)(o.convertStatusToText(t.status)),1)):(0,r.Q3)("",!0),4==t.status?((0,r.uX)(),(0,r.CE)("td",je,(0,n.v_)(o.convertStatusToText(t.status)),1)):(0,r.Q3)("",!0),0==t.status?((0,r.uX)(),(0,r.CE)("td",Ee,(0,n.v_)(o.convertStatusToText(t.status)),1)):(0,r.Q3)("",!0),(0,r.Lk)("td",null,[0==t.status||3==t.status||4==t.status?((0,r.uX)(),(0,r.CE)("button",{key:0,style:{width:"100px"},class:"btn-add",onClick:e=>o.editPlan(t.std_id,t.stdplan_id,t.std_name,t.std_last,t.batch_year,t.status)},"จัดแผน",8,we)):(0,r.Q3)("",!0),2==t.status?((0,r.uX)(),(0,r.CE)("button",{key:1,style:{width:"100px"},class:"btn-remove",onClick:e=>o.editPlan(t.std_id,t.stdplan_id,t.std_name,t.std_last,t.batch_year,t.status,t.reason)},"แก้ไข",8,Se)):(0,r.Q3)("",!0)])])))),128))])])):(0,r.Q3)("",!0),i.student_data.length?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",xe,e[5]||(e[5]=[(0,r.Lk)("h3",null,"กรุณาเลือกรุ่นปีการศึกษา",-1)])))])])),_:1})}var Pe={name:"tc_student_list",components:{MainLayout:f},data(){return{students:[],year:[],student_data:[],sortedStudents:[],select_year:"",select_status:""}},methods:{async fetchStudent_list(){try{const t=await U.A.get("http://127.0.0.1:3000/api/getStudent_plan");"1"===t.data.result?(console.log(t.data.datalist),this.students=t.data.datalist,this.extract_year()):alert("ไม่มีข้อมูลนักศึกษาในระบบ")}catch(t){console.error("Error fetching student data:",t)}},extract_year(){const t=this.students.map((t=>t.batch_year));this.year=[...new Set(t)].sort(((t,e)=>e-t))},extract_students_by_year(){const t=this.students.filter((t=>t.batch_year===this.select_year));this.student_data=t,this.sort_by_status()},sort_by_status(){if(""===this.select_status){const t=this.students.filter((t=>t.batch_year===this.select_year));this.sortedStudents=t}else{const t=this.student_data.filter((t=>Number(t.status)===Number(this.select_status)));this.sortedStudents=t}},convertStatusToText(t){const e={1:"ยืนยัน",2:"แก้ไข",3:"รอการยืนยัน",4:"ไม่สมบูรณ์",0:"รอจัดแผนการเรียน"};return e[t]||"สถานะไม่ทราบ"},async editPlan(t,e,s,a,r,l,i){this.$router.push({name:"tc_editStudent_plan",query:{std_id:t,stdplan_id:e,std_name:s,std_last:a,year:r,status:l,reason:i}})}},watch:{select_year(t){console.log("Selected year:",t),this.extract_students_by_year(),this.select_status="",this.sort_by_status()},select_status(t){console.log("Selected year:",t),this.sort_by_status()}},mounted(){this.fetchStudent_list()}};const Te=(0,g.A)(Pe,[["render",Xe]]);var Ae=Te;const Qe={class:"form-container"},$e={key:0,class:"fixed-box"},Ne=["value"],Oe={key:2,class:"popup-overlay"},Fe={class:"popup-content"},Ie={class:"dropdown-container",style:{width:"600px"}},qe={key:0},We={class:"data-stdplan-table"},Ge={key:0},Ue={key:0,style:{"text-align":"left"}},Ke={key:1,style:{"text-align":"left"}},De={key:2},Re={key:3},ze={key:4},Je={class:"btn-group",style:{gap:"5px"}},Ve=["onClick"],Me=["onClick"],Be={class:"dropdown-container"},He=["disabled"],Ye=["value"],Ze=["disabled"],ts=["value"],es=["disabled"],ss={key:0},as=["onClick"],rs={class:"btn-group"},ls={class:"data-stdplan-table",style:{"margin-bottom":"100px"}},is={colspan:"7",style:{"text-align":"left"}},ns={key:0,style:{color:"#ff1a1a"}},os={style:{"text-align":"left"}},cs={key:1,style:{color:"#33cc33"}},us={style:{"text-align":"left"}},ds={key:2,style:{color:"#ffcc00"}},_s={style:{"text-align":"left"}};function ps(t,e,s,l,i,o){const c=(0,r.g2)("MainLayout");return(0,r.uX)(),(0,r.Wv)(c,null,{default:(0,r.k6)((()=>[(0,r.Lk)("div",Qe,[e[35]||(e[35]=(0,r.Lk)("h1",null,"จัดแผนการเรียนรายบุคคล",-1)),(0,r.Lk)("h2",null,"รหัสนักศึกษา: "+(0,n.v_)(i.std_id)+" ชื่อ: "+(0,n.v_)(i.std_name)+" "+(0,n.v_)(i.std_last),1),2==i.status?((0,r.uX)(),(0,r.CE)("div",$e,[(0,r.Lk)("h3",null,"สาเหตุ: "+(0,n.v_)(i.reason),1)])):(0,r.Q3)("",!0),0==i.status?(0,r.bo)(((0,r.uX)(),(0,r.CE)("select",{key:1,"onUpdate:modelValue":e[0]||(e[0]=t=>i.selectPlan=t),onChange:e[1]||(e[1]=(...t)=>o.fetchPlan_list&&o.fetchPlan_list(...t))},[e[15]||(e[15]=(0,r.Lk)("option",{value:"",disabled:""},"เลือกแผนการเรียน",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.plans_list,(t=>((0,r.uX)(),(0,r.CE)(r.FK,{key:t.plan_id},[Number(i.year)==Number(t.batch_year)?((0,r.uX)(),(0,r.CE)("option",{key:0,value:t.plan_id},(0,n.v_)(t.plan_id),9,Ne)):(0,r.Q3)("",!0)],64)))),128))],544)),[[a.u1,i.selectPlan]]):(0,r.Q3)("",!0),i.change_popup?((0,r.uX)(),(0,r.CE)("div",Oe,[(0,r.Lk)("div",Fe,[(0,r.Lk)("h3",null,"ย้ายรายวิชา "+(0,n.v_)(i.sub_name)+" ไป",1),(0,r.Lk)("div",Ie,[(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>i.select_year=t),id:"year"},e[16]||(e[16]=[(0,r.Lk)("option",{value:"",disabled:""},"เลือกปี",-1),(0,r.Lk)("option",{value:"3"},"ปี 3",-1),(0,r.Lk)("option",{value:"4"},"ปี 4",-1)]),512),[[a.u1,i.select_year]]),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>i.select_term=t),id:"term"},[e[17]||(e[17]=(0,r.Lk)("option",{value:"",disabled:""},"เลือกเทอม",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.open_subject,(t=>((0,r.uX)(),(0,r.CE)(r.FK,{key:t.subject_id},[t.subject_id===i.sub_id?((0,r.uX)(),(0,r.CE)("option",qe,(0,n.v_)(t.term),1)):(0,r.Q3)("",!0)],64)))),128))],512),[[a.u1,i.select_term]])]),(0,r.Lk)("button",{class:"btn-remove",style:{"font-size":"18px","background-color":"#00ff00","margin-right":"10px"},onClick:e[4]||(e[4]=(...t)=>o.update_plan&&o.update_plan(...t))},"ยืนยัน"),(0,r.Lk)("button",{class:"btn-remove",style:{"font-size":"18px","background-color":"#a3a3a3"},onClick:e[5]||(e[5]=(...t)=>o.closePopup&&o.closePopup(...t))},"ยกเลิก")])])):(0,r.Q3)("",!0),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.groupedPlan,(t=>((0,r.uX)(),(0,r.CE)("div",{key:t.yearTerm,class:"grouped-table"},[(0,r.Lk)("h2",null,"ภาคเรียนที่ "+(0,n.v_)(t.term)+" ปีการศึกษา "+(0,n.v_)(4===t.year?Number(i.year)+1:i.year),1),(0,r.Lk)("table",We,[(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[e[18]||(e[18]=(0,r.Lk)("th",{style:{width:"120px"}},"รหัสวิชา",-1)),e[19]||(e[19]=(0,r.Lk)("th",{style:{width:"450px"}},"ชื่อวิชา",-1)),e[20]||(e[20]=(0,r.Lk)("th",null,"หน่วยกิต",-1)),e[21]||(e[21]=(0,r.Lk)("th",null,"กลุ่มวิชา",-1)),t?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("th",Ge))])]),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(t.plans,(s=>((0,r.uX)(),(0,r.CE)("tr",{key:s.subject_id},[(0,r.Lk)("td",null,(0,n.v_)(s.subject_id),1),s.subject_name?((0,r.uX)(),(0,r.CE)("td",Ue,(0,n.v_)(s.subject_name),1)):(0,r.Q3)("",!0),s.subject_name?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("td",Ke,(0,n.v_)(s.subject_nameTh),1)),s.theory_credits+s.practical_credits<3?((0,r.uX)(),(0,r.CE)("td",De,(0,n.v_)(s.practical_credits+s.theory_credits)+"("+(0,n.v_)(s.theory_credits)+"-"+(0,n.v_)(2*s.practical_credits)+"-"+(0,n.v_)(3-(s.theory_credits+2*s.practical_credits))+") ",1)):(0,r.Q3)("",!0),s.theory_credits+s.practical_credits>=3&&s.theory_credits+s.practical_credits<=5?((0,r.uX)(),(0,r.CE)("td",Re,(0,n.v_)(s.practical_credits+s.theory_credits)+"("+(0,n.v_)(s.theory_credits)+"-"+(0,n.v_)(2*s.practical_credits)+"-"+(0,n.v_)(9-(s.theory_credits+2*s.practical_credits))+") ",1)):(0,r.Q3)("",!0),s.theory_credits+s.practical_credits==6?((0,r.uX)(),(0,r.CE)("td",ze,(0,n.v_)(s.practical_credits+s.theory_credits)+"("+(0,n.v_)(s.theory_credits)+"-"+(0,n.v_)(s.practical_credits)+"-0) ",1)):(0,r.Q3)("",!0),(0,r.Lk)("td",null,(0,n.v_)(s.group_id),1),(0,r.Lk)("td",null,[(0,r.Lk)("div",Je,[(0,r.Lk)("button",{class:"btn-remove",onClick:t=>o.openChangePopup(s.subject_name,s.subject_id),style:{"background-color":"#00ccff","margin-right":"10px"}},e[22]||(e[22]=[(0,r.Lk)("i",{class:"fa-solid fa-repeat"},null,-1)]),8,Ve),(0,r.Lk)("button",{class:"btn-remove",onClick:e=>o.removeFromTemp_data(s.subject_id,t.year,t.term)},e[23]||(e[23]=[(0,r.Lk)("i",{class:"fa-regular fa-trash-can"},null,-1)]),8,Me)])])])))),128)),(0,r.Lk)("tr",null,[e[24]||(e[24]=(0,r.Lk)("td",{colspan:"2",style:{"text-align":"right"}},"รวมหน่วยกิต:",-1)),(0,r.Lk)("td",null,(0,n.v_)(t.totalCredits),1),e[25]||(e[25]=(0,r.Lk)("td",{colspan:"2"},null,-1))])])]),e[30]||(e[30]=(0,r.Lk)("br",null,null,-1)),(0,r.Lk)("div",Be,[(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":e[6]||(e[6]=t=>i.selectGroup=t),onChange:e[7]||(e[7]=(...t)=>o.fetchStructure&&o.fetchStructure(...t)),style:{"margin-right":"10px"},disabled:t.totalCredits>=22&&1==i.spacialTerm},[e[26]||(e[26]=(0,r.Lk)("option",{value:"",disabled:""},"เลือกกลุ่มวิชา",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.filteredGroups(t.term),(t=>((0,r.uX)(),(0,r.CE)("option",{key:t.group_id,value:t.group_id},(0,n.v_)(t.group_id+" "+t.group_name),9,Ye)))),128))],40,He),[[a.u1,i.selectGroup]]),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":e[8]||(e[8]=t=>i.selectsubject=t),onChange:e[9]||(e[9]=(...t)=>o.fetchOpen_subject&&o.fetchOpen_subject(...t)),style:{"margin-right":"10px"},disabled:!i.selectGroup||t.totalCredits>=22&&1==i.spacialTerm},[e[27]||(e[27]=(0,r.Lk)("option",{value:"",disabled:""},"เลือกวิชา",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(t.open,(t=>((0,r.uX)(),(0,r.CE)(r.FK,{key:t.subject_id},[i.selectGroup==t.group_id?((0,r.uX)(),(0,r.CE)("option",{key:0,value:t.subject_id},(0,n.v_)(t.subject_name),9,ts)):(0,r.Q3)("",!0)],64)))),128))],40,Ze),[[a.u1,i.selectsubject]]),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":e[10]||(e[10]=t=>i.selectGroup_id=t),onChange:e[11]||(e[11]=(...t)=>o.fetchSubject&&o.fetchSubject(...t)),style:{width:"150px","margin-right":"10px"},disabled:!i.selectsubject||t.totalCredits>=22&&1==i.spacialTerm},[e[28]||(e[28]=(0,r.Lk)("option",{value:"",disabled:""},"กลุ่มวิชา",-1)),(0,r.Lk)("option",null,(0,n.v_)(i.selectGroup),1),2.2!=i.selectGroup?((0,r.uX)(),(0,r.CE)("option",ss," 3.1")):(0,r.Q3)("",!0)],40,es),[[a.u1,i.selectGroup_id]]),t.totalCredits<25&&0==i.spacialTerm||!(t.totalCredits>=22&&1==i.spacialTerm)?((0,r.uX)(),(0,r.CE)("button",{key:0,type:"submit",class:"submit-stdplan-button",style:{"font-size":"20px"},onClick:e=>o.addToTemp_data(t.year,t.term,t)},e[29]||(e[29]=[(0,r.Lk)("i",{class:"fa-solid fa-plus"},null,-1)]),8,as)):(0,r.Q3)("",!0)])])))),128)),e[36]||(e[36]=(0,r.Lk)("h4",{style:{"font-weight":"lighter"}},[(0,r.eW)(" ***หมายเหตุ หน่วยกิตที่แสดงประกอบด้วย "),(0,r.Lk)("br"),(0,r.eW)(" ผลรวมของหน่วยกิต(เวลาเรียนภาคทฤษฎี-เวลาเรียนภาคประติบัติ-เวลาเรียนนอกห้องเรียน)")],-1)),(0,r.Lk)("div",rs,[(0,r.Lk)("button",{class:"btn-back",style:{"font-size":"20px",width:"200px"},onClick:e[12]||(e[12]=(...t)=>o.goBack&&o.goBack(...t))},e[31]||(e[31]=[(0,r.Lk)("i",{class:"fa-solid fa-arrow-left-long"}," กลับ",-1)])),1!=i.status?((0,r.uX)(),(0,r.CE)("button",{key:0,class:"btn-back",style:{"font-size":"20px",width:"200px","background-color":"#3385ff"},onClick:e[13]||(e[13]=(...t)=>o.resetChanges&&o.resetChanges(...t))},e[32]||(e[32]=[(0,r.Lk)("i",{class:"fa-solid fa-arrow-rotate-left"}," รีเซ็ตแผน",-1)]))):(0,r.Q3)("",!0),1!=i.status?((0,r.uX)(),(0,r.CE)("button",{key:1,class:"btn-back",style:{"font-size":"20px",width:"200px","background-color":"#33cc33"},onClick:e[14]||(e[14]=(...t)=>o.saveChanges&&o.saveChanges(...t))},e[33]||(e[33]=[(0,r.Lk)("i",{class:"fa-solid fa-floppy-disk"}," บันทึกแผน",-1)]))):(0,r.Q3)("",!0)]),(0,r.Lk)("h2",null,"หน่วยกิตเทียบได้: "+(0,n.v_)(o.totalTransferCredits)+" หน่วยกิตรวมในแผน: "+(0,n.v_)(o.totalAllCredits)+" หน่วยกิตที่ต้องเรียน: 125",1),e[37]||(e[37]=(0,r.Lk)("h2",null,"สรุปแผนการเรียนทั้งหมด",-1)),(0,r.Lk)("table",ls,[e[34]||(e[34]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",null,"กลุ่มวิชา"),(0,r.Lk)("th",null,"หน่วยกิตที่ต้องเรียน"),(0,r.Lk)("th",null,"เทียบโอนได้"),(0,r.Lk)("th",null,"ในแผน"),(0,r.Lk)("th",null,"หน่วยกิตรวม"),(0,r.Lk)("th",null,"ขาด")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.credit_status,((t,e)=>((0,r.uX)(),(0,r.CE)(r.FK,{key:e},[(0,r.Lk)("tr",null,[(0,r.Lk)("td",is,[(0,r.Lk)("strong",null,(0,n.v_)(e),1)])]),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(t,(t=>((0,r.uX)(),(0,r.CE)(r.FK,{key:t._id},["❌"==t.status?((0,r.uX)(),(0,r.CE)("tr",ns,[(0,r.Lk)("td",os,(0,n.v_)(t.group_id+" "+t.group_name),1),(0,r.Lk)("td",null,(0,n.v_)(t.required_credits),1),(0,r.Lk)("td",null,(0,n.v_)(t.tranfer_credits),1),(0,r.Lk)("td",null,(0,n.v_)(t.need_credit),1),(0,r.Lk)("td",null,(0,n.v_)(t.earned_credits),1),(0,r.Lk)("td",null,(0,n.v_)(t.credit_isneed),1)])):(0,r.Q3)("",!0),"✔️"==t.status&&t.required_credits==t.earned_credits?((0,r.uX)(),(0,r.CE)("tr",cs,[(0,r.Lk)("td",us,(0,n.v_)(t.group_id+" "+t.group_name),1),(0,r.Lk)("td",null,(0,n.v_)(t.required_credits),1),(0,r.Lk)("td",null,(0,n.v_)(t.tranfer_credits),1),(0,r.Lk)("td",null,(0,n.v_)(t.need_credit),1),(0,r.Lk)("td",null,(0,n.v_)(t.earned_credits),1),(0,r.Lk)("td",null,(0,n.v_)(t.credit_isneed),1)])):(0,r.Q3)("",!0),t.earned_credits>t.required_credits?((0,r.uX)(),(0,r.CE)("tr",ds,[(0,r.Lk)("td",_s,(0,n.v_)(t.group_id+" "+t.group_name),1),(0,r.Lk)("td",null,(0,n.v_)(t.required_credits),1),(0,r.Lk)("td",null,(0,n.v_)(t.tranfer_credits),1),(0,r.Lk)("td",null,(0,n.v_)(t.need_credit),1),(0,r.Lk)("td",null,(0,n.v_)(t.earned_credits),1),(0,r.Lk)("td",null,(0,n.v_)(t.credit_isneed),1)])):(0,r.Q3)("",!0)],64)))),128))],64)))),128))])])])])),_:1})}var hs={name:"tc_editStudent_plan",components:{MainLayout:f},computed:{calculateTotalCredits(){return t=>t.reduce(((t,e)=>{const s=e.theory_credits+e.practical_credits;return t+s}),0)},totalAllCredits(){return this.groupedPlan.reduce(((t,e)=>t+e.totalCredits),0)},filteredGroups(){return t=>("ภาคฤดูร้อน"==t&&(t=3),this.group_list.filter((e=>this.sort_open_list.some((s=>s.group_id===e.group_id&&s.term==t)))))},credit_status(){return this.group_list.reduce(((t,e)=>(t[e.sort]||(t[e.sort]=[]),t[e.sort].push(e),t)),{})},totalPracticalCredits(){return this.transfer_list.reduce(((t,e)=>t+Number(e.practical_credits||0)),0)},totalTheoryCredits(){return this.transfer_list.reduce(((t,e)=>t+Number(e.theory_credits||0)),0)},totalTransferCredits(){return this.totalPracticalCredits+this.totalTheoryCredits}},data(){return{std_id:this.$route.query.std_id,stdplan_id:this.$route.query.stdplan_id,std_name:this.$route.query.std_name,std_last:this.$route.query.std_last,year:this.$route.query.year,status:this.$route.query.status,reason:this.$route.query.reason,std_planlist:[],temp_planlist:[],term:"",groupedPlan:[],selectGroup:"",group_list:[],subject_list:[],plans_list:[],selectPlan:"",selectsubject:"",selectGroup_id:"",spacialTerm:!1,open_subject:[],transfer_list:[],change_popup:!1,sub_name:"",sub_id:"",select_term:"",select_year:"",sort_open_list:[]}},methods:{openChangePopup(t,e){this.sub_name=t,this.sub_id=e,this.change_popup=!0},closePopup(){this.change_popup=!1},async fetchOpen_subject(){console.log(this.selectGroup);try{const t=await U.A.post("http://127.0.0.1:3000/api/getopensubject",{});"1"==t.data.result?(this.open_subject=t.data.datalist,this.sort_openlist(),this.groupPlans()):"2"==t.data.result&&(this.open_subject=[],this.sort_openlist(),this.groupPlans())}catch(t){console.error("Error fetching subject:",t)}},async fetchPlan_list(){try{const t=await U.A.get("http://127.0.0.1:3000/api/getStandard_plan",{});this.plans_list=t.data.datalist}catch(t){console.error("Error fetching subject:",t)}},async fetchTransfer_list(){try{const t=await U.A.post("http://127.0.0.1:3000/api/getTranfer_plan",{std_id:this.std_id});"1"==t.data.result?(console.log("..--..",t.data.datalist),this.transfer_list=t.data.datalist):"0"==t.data.result&&(this.transfer_list=[])}catch(t){console.error("Error fetching subject:",t)}},async fetchStandardPlan_list(){this.std_planlist=[];try{const t=await U.A.post("http://127.0.0.1:3000/api/getStandard_list",{plan_id:this.selectPlan});"1"==t.data.result?(console.log(t.data.datalist),this.std_planlist=t.data.datalist,this.std_planlist=this.std_planlist.filter((t=>!this.transfer_list.some((e=>t.subject_id===e.subject_id)))),this.temp_planlist=JSON.parse(JSON.stringify(this.std_planlist)),this.groupPlans()):"2"==t.data.result&&(this.std_planlist=[],this.groupPlans())}catch(t){console.error("Error fetching subject:",t)}},async fetchStudent_plan(){try{const t=await U.A.post("http://127.0.0.1:3000/api/getStudentplan_list",{std_id:this.std_id});"1"===t.data.result?(console.log(t.data.datalist),this.std_planlist=t.data.datalist,this.temp_planlist=JSON.parse(JSON.stringify(this.std_planlist)),this.sort_openlist(),this.groupPlans()):"0"===t.data.result&&(this.std_planlist=[],this.temp_planlist=[],this.groupPlans())}catch(t){console.error("Error fetching subjects:",t)}},async fetchStructure(){try{const t=await U.A.get("http://127.0.0.1:3000/api/getStructure",{});this.group_list=t.data.datalist,this.mergeCredits()}catch(t){console.error("Error fetching subject:",t)}},async fetchSubject(){try{if(!this.selectGroup)return void(this.subject_list=[]);const t=await U.A.post("http://127.0.0.1:3000/api/getSubject",{group_id:this.selectGroup});"1"==t.data.result?this.subject_list=t.data.datalist:alert("ไม่มีข้อมูลวิชาในกลุ่มที่เลือก")}catch(t){console.error("Error fetching subject:",t)}},sort_openlist(){this.sort_open_list=this.open_subject.filter((t=>!this.temp_planlist.some((e=>e.subject_id===t.subject_id))))},addToTemp_data(t,e,s){if(""==this.selectsubject||""==this.selectGroup)return void alert("กรุณาเลือกกลุ่มวิชาและรายวิชาที่ต้องการเพิ่ม");let a=this.calculateTotalCredits(s.plans),r=this.open_subject.find((t=>t.subject_id===String(this.selectsubject))),l=this.temp_planlist.find((t=>t.subject_id===String(this.selectsubject)));if(l)return void alert("ไม่สามารถเพิ่มวิชาซ้ำได้");let i=Number(r.practical_credits),n=Number(r.theory_credits),o=a+i,c=a+n;if(confirm("ต้องการจะเพิ่มวิชานี้หรือไม่")){if(o>25||c>25)return void alert("ไม่สามารถเพิ่มได้ เนื่องจากหน่วยกิตรวมเกิน 25");if((o>22||c>22)&&1==this.spacialTerm)return void alert("ไม่สามารถเพิ่มได้ เนื่องจากมีเทอมที่หน่วยกิตเกิน 25 แล้ว");if((o>=22||c>22)&&!confirm("หน่วยกิตเกิน 22 ต้องการดำเนินการต่อหรือไม่?"))return;const s={group_id:this.selectGroup_id,subject_id:r.subject_id,term:e,year:t,practical_credits:r.practical_credits,theory_credits:r.theory_credits,subject_name:r.subject_name};this.temp_planlist.push(s),this.sort_openlist(),this.groupPlans(),this.mergeCredits(),console.log("เพิ่มข้อมูลใน temp_planlist สำเร็จ")}},update_plan(){let t=this.temp_planlist.filter((t=>t.year===Number(this.select_year)&&t.term===Number(this.select_term)));console.log("Filtered Plans:",t);let e=t.reduce(((t,e)=>t+Number(e.practical_credits||0)),0),s=t.reduce(((t,e)=>t+Number(e.theory_credits||0)),0),a=this.open_subject.find((t=>t.subject_id===String(this.sub_id)));if(!a)return void alert("ไม่พบวิชาที่เลือก กรุณาลองใหม่");let r=Number(a.practical_credits),l=Number(a.theory_credits),i=e+s,n=i+r,o=i+l;if(console.log(`New Practical Credits: ${n}, New Theory Credits: ${o}`),confirm("ต้องการที่จะย้ายวิชานี้ใช่หรือไม่")){if(n>25||o>25)return void alert("ไม่สามารถเพิ่มได้ เนื่องจากหน่วยกิตรวมเกิน 25");if((n>=22||o>22)&&!confirm("หน่วยกิตในเทอมเกิน 22 ต้องการดำเนินการต่อหรือไม่?"))return;let t=this.temp_planlist.find((t=>t.subject_id===this.sub_id));t?(t.year=Number(this.select_year),t.term=Number(this.select_term),t.hasChanged=!0,console.log("อัปเดตข้อมูลใน temp_planlist สำเร็จ"),this.change_popup=!1):alert("ไม่พบรายวิชานี้ในแผนการเรียน"),this.sort_openlist(),this.groupPlans(),this.mergeCredits()}},removeFromTemp_data(t,e,s){"ภาคฤดูร้อน"==s&&(s=3),confirm("คุณต้องการลบวิชานี้หรือไม่?")&&(this.temp_planlist=this.temp_planlist.filter((e=>!(e.subject_id===t&&e.term===s))),this.sort_openlist(),this.groupPlans(),console.log(`ลบข้อมูลที่มี subject_id=${t}, year=${e}, term=${s} สำเร็จ`))},resetChanges(){this.temp_planlist=JSON.parse(JSON.stringify(this.std_planlist)),this.sort_openlist(),this.groupPlans(),alert("รีเซ็ตข้อมูลเรียบร้อยแล้ว!")},async saveChanges(){const t=this.std_planlist,e=this.temp_planlist;if(JSON.stringify(t)!==JSON.stringify(e)){if(confirm("คุณต้องการบันทึกการเปลี่ยนแปลงหรือไม่?")){let t=3;const e=Object.values(this.credit_status).some((t=>t.some((t=>"❌"===t.status))));if(e){if(!confirm("คุณกำลังบันทึกข้อมูลที่ไม่สมบูรณ์ ต้องการดำเนินการต่อหรือไม่?"))return;t=4}try{let e=Array.isArray(this.temp_planlist)?this.temp_planlist:[this.temp_planlist];console.log("planData:",e);const s=await U.A.post("http://127.0.0.1:3000/api/updateStudentplan_list",{std_id:this.std_id,plans:e,status:t});"1"===s.data.result?(alert("บันทึกสำเร็จ!"),this.std_planlist=JSON.parse(JSON.stringify(this.temp_planlist)),this.$router.push("/student_plan_list")):alert("เกิดข้อผิดพลาดในการบันทึกข้อมูล")}catch(s){console.error("Error saving changes:",s)}}}else alert("ไม่มีการเปลี่ยนแปลงข้อมูล")},groupPlans(){const t=[[3,1],[3,2],[3,3],[4,1],[4,2]];this.groupedPlan=t.map((([t,e])=>{const s=this.temp_planlist.filter((s=>s.year===t&&s.term===e)),a=s.reduce(((t,e)=>(t+(e.theory_credits+e.practical_credits)>22&&(this.spacialTerm=!0),t+(e.theory_credits+e.practical_credits))),0);return{yearTerm:`${t}-${e}`,year:t,term:3===e?"ภาคฤดูร้อน":e,plans:this.temp_planlist.filter((s=>s.year===t&&s.term===e)),totalCredits:a,open:this.sort_open_list.filter((t=>t.term===e))}}))},mergeCredits(){this.group_list=this.group_list.map((t=>{let e=this.temp_planlist.filter((e=>String(e.group_id)===String(t.group_id))),s=this.transfer_list.filter((e=>String(e.group_id)===String(t.group_id))),a=e.reduce(((t,e)=>t+(e.theory_credits+e.practical_credits)),0),r=s.reduce(((t,e)=>t+(e.theory_credits+e.practical_credits)),0),l=a+r,i=t.credit-l;i<0&&(i=0);let n=l>=t.credit?"✔️":"❌";return{...t,_id:Date.now().toString(),required_credits:t.credit,tranfer_credits:r,need_credit:a,earned_credits:l,credit_isneed:i,status:n}})),console.log("อัปเดต group_list:",this.group_list)},goBack(){const t=this.std_planlist,e=this.temp_planlist;JSON.stringify(t)!==JSON.stringify(e)?confirm("คุณไม่ได้บันทึกข้อมูล ต้องการกลับหรือไม่?")&&this.$router.go(-1):this.$router.go(-1)}},watch:{selectGroup(t){console.log("Group ID changed:",t),this.selectGroup_id=t,this.fetchOpen_subject()},selectPlan(t){this.selectPlan=t,this.fetchStandardPlan_list()},temp_planlist(t){console.log("temp_planlist changed:",t),this.mergeCredits()}},async mounted(){await this.fetchStudent_plan(),await this.fetchTransfer_list(),await this.fetchSubject(),await this.fetchPlan_list(),await this.fetchOpen_subject(),this.fetchStructure()}};const ys=(0,g.A)(hs,[["render",ps]]);var ks=ys;const bs={class:"form-container"},gs={class:"dropdown-container"},ms=["value"],fs=["disabled"],Ls={key:0,class:"student-table"},vs={style:{"text-align":"left"}},Cs={key:0,style:{color:"green"}},js={key:1,style:{color:"red"}},Es={key:2,style:{color:"orange"}},ws={key:3,style:{color:"red"}},Ss={key:4,style:{color:"blue"}},xs=["onClick"],Xs={key:1};function Ps(t,e,s,l,i,o){const c=(0,r.g2)("MainLayout");return(0,r.uX)(),(0,r.Wv)(c,null,{default:(0,r.k6)((()=>[(0,r.Lk)("div",bs,[e[7]||(e[7]=(0,r.Lk)("h1",null,"ยืนยันแผนการเรียนรายบุคคล",-1)),(0,r.Lk)("div",gs,[(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>i.select_year=t),style:{"font-size":"20px"}},[e[2]||(e[2]=(0,r.Lk)("option",{value:"",disabled:""},"เลือกรุ่นปีการศึกษา",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.year,(t=>((0,r.uX)(),(0,r.CE)("option",{key:t,value:t},(0,n.v_)(t),9,ms)))),128))],512),[[a.u1,i.select_year]]),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>i.select_status=t),style:{"font-size":"20px"},disabled:!i.select_year},e[3]||(e[3]=[(0,r.Lk)("option",{value:""},"ทั้งหมด",-1),(0,r.Lk)("option",{value:"0"},"รอจัดแผนการเรียน",-1),(0,r.Lk)("option",{value:"1"},"ยืนยัน",-1),(0,r.Lk)("option",{value:"2"},"แก้ไข",-1),(0,r.Lk)("option",{value:"3"},"รอการยืนยัน",-1),(0,r.Lk)("option",{value:"4"},"ไม่สมบูรณ์",-1)]),8,fs),[[a.u1,i.select_status]])]),e[8]||(e[8]=(0,r.Lk)("h2",null,"ตารางรายชื่อนักศึกษา",-1)),i.student_data.length?((0,r.uX)(),(0,r.CE)("table",Ls,[e[5]||(e[5]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",null,"รหัสนักศึกษา"),(0,r.Lk)("th",null,"ชื่อ"),(0,r.Lk)("th",null,"รุ่นปี"),(0,r.Lk)("th",null,"สถานะ"),(0,r.Lk)("th")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.sortedStudents,(t=>((0,r.uX)(),(0,r.CE)("tr",{key:t.std_id},[(0,r.Lk)("td",null,(0,n.v_)(t.std_id),1),(0,r.Lk)("td",vs,(0,n.v_)(t.std_name)+" "+(0,n.v_)(t.std_last),1),(0,r.Lk)("td",null,(0,n.v_)(t.batch_year),1),1==t.status?((0,r.uX)(),(0,r.CE)("td",Cs,(0,n.v_)(o.convertStatusToText(t.status)),1)):(0,r.Q3)("",!0),2==t.status?((0,r.uX)(),(0,r.CE)("td",js,(0,n.v_)(o.convertStatusToText(t.status)),1)):(0,r.Q3)("",!0),3==t.status?((0,r.uX)(),(0,r.CE)("td",Es,(0,n.v_)(o.convertStatusToText(t.status)),1)):(0,r.Q3)("",!0),4==t.status?((0,r.uX)(),(0,r.CE)("td",ws,(0,n.v_)(o.convertStatusToText(t.status)),1)):(0,r.Q3)("",!0),0==t.status?((0,r.uX)(),(0,r.CE)("td",Ss,(0,n.v_)(o.convertStatusToText(t.status)),1)):(0,r.Q3)("",!0),(0,r.Lk)("td",null,[0!=t.status?((0,r.uX)(),(0,r.CE)("button",{key:0,class:"btn-add",style:{"font-size":"16px",width:"100px"},onClick:e=>o.inspectPlan(t.std_id,t.stdplan_id,t.status,t.std_name,t.std_last,t.batch_year)},e[4]||(e[4]=[(0,r.Lk)("i",{class:"fa-solid fa-magnifying-glass"},null,-1)]),8,xs)):(0,r.Q3)("",!0)])])))),128))])])):(0,r.Q3)("",!0),i.student_data.length?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",Xs,e[6]||(e[6]=[(0,r.Lk)("h3",null,"กรุณาเลือกรุ่นปีการศึกษา",-1)])))])])),_:1})}var Ts={name:"tc_submitplan_list",components:{MainLayout:f},data(){return{students:[],year:[],student_data:[],sortedStudents:[],select_year:"",select_status:""}},methods:{async fetchStudent_list(){try{const t=await U.A.get("http://127.0.0.1:3000/api/getStudent_plan");"1"===t.data.result&&(console.log(t.data.datalist),this.students=t.data.datalist,this.extract_year())}catch(t){console.error("Error fetching student data:",t)}},extract_year(){const t=this.students.map((t=>t.batch_year));this.year=[...new Set(t)].sort(((t,e)=>e-t))},extract_students_by_year(){const t=this.students.filter((t=>t.batch_year===this.select_year));this.student_data=t,this.sort_by_status()},sort_by_status(){if(""===this.select_status){const t=this.students.filter((t=>t.batch_year===this.select_year));this.sortedStudents=t}else{const t=this.student_data.filter((t=>Number(t.status)===Number(this.select_status)));this.sortedStudents=t}},convertStatusToText(t){const e={1:"ยืนยัน",2:"แก้ไข",3:"รอการยืนยัน",4:"ไม่สมบูรณ์",0:"รอจัดแผนการเรียน"};return e[t]||"สถานะไม่ทราบ"},async inspectPlan(t,e,s,a,r,l){console.log(s),s=0==s?"0":2==s?"2":3==s?"3":4==s?"4":"1",console.log(s),this.$router.push({name:"tc_inspect_plan",query:{std_id:t,stdplan_id:e,status:s,std_name:a,std_last:r,year:l}})},openPreviewWindow(){const t=this.sortedStudents.filter((t=>1===t.status));console.log("นักศึกษาที่มี status = 1:",t);const e=1,s=encodeURIComponent("แผนการเรียนรายบุคคล"),a=encodeURIComponent(JSON.stringify(t)),r=`http://127.0.0.1:3000/api/pdf_generate?title=${s}&content=${a}&status=${e}`;window.open(r,"_blank")}},watch:{select_year(t){console.log("Selected year:",t),this.extract_students_by_year(),this.select_status="",this.sort_by_status()},select_status(t){console.log("Selected year:",t),this.sort_by_status()}},mounted(){this.fetchStudent_list()}};const As=(0,g.A)(Ts,[["render",Ps]]);var Qs=As;const $s={class:"form-container"},Ns={class:"data-stdplan-table"},Os={style:{"text-align":"left",width:"450px"}},Fs={key:0},Is={key:1},qs={key:2},Ws={key:3},Gs={key:4},Us={key:0,class:"btn-group",style:{display:"flex","justify-content":"center",gap:"20px"}},Ks={key:0,class:"popup-overlay"},Ds={class:"popup-content"},Rs={class:"btn-group",style:{"margin-bottom":"100px",gap:"500px"}};function zs(t,e,s,l,i,o){const c=(0,r.g2)("font-awesome-icon"),u=(0,r.g2)("MainLayout");return(0,r.uX)(),(0,r.Wv)(u,null,{default:(0,r.k6)((()=>[(0,r.Lk)("div",$s,[e[19]||(e[19]=(0,r.Lk)("h1",null,"แผนการเรียนรายบุคคล",-1)),(0,r.Lk)("h2",null,"รหัสนักศึกษา: "+(0,n.v_)(i.std_id)+" ชื่อ: "+(0,n.v_)(i.std_name)+" "+(0,n.v_)(i.std_last),1),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.groupedPlan,(t=>((0,r.uX)(),(0,r.CE)("div",{key:t.yearTerm,class:"grouped-table"},[(0,r.Lk)("h2",null,"ภาคเรียนที่ "+(0,n.v_)(t.term)+" ปีการศึกษา "+(0,n.v_)(4===t.year?Number(i.year)+1:i.year),1),(0,r.Lk)("table",Ns,[e[10]||(e[10]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",null,"รหัสวิชา"),(0,r.Lk)("th",null,"ชื่อวิชา"),(0,r.Lk)("th",null,"หน่วยกิต"),(0,r.Lk)("th",null,"กลุ่มวิชา")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(t.plans,(t=>((0,r.uX)(),(0,r.CE)("tr",{key:t.subject_id},[(0,r.Lk)("td",null,(0,n.v_)(t.subject_id),1),(0,r.Lk)("td",Os,(0,n.v_)(t.subject_name),1),t.theory_credits+t.practical_credits<3?((0,r.uX)(),(0,r.CE)("td",Fs,(0,n.v_)(t.practical_credits+t.theory_credits)+"("+(0,n.v_)(t.theory_credits)+"-"+(0,n.v_)(2*t.practical_credits)+"-"+(0,n.v_)(3-(t.theory_credits+2*t.practical_credits))+") ",1)):(0,r.Q3)("",!0),t.theory_credits+t.practical_credits>=3&&t.theory_credits+t.practical_credits<=5?((0,r.uX)(),(0,r.CE)("td",Is,(0,n.v_)(t.practical_credits+t.theory_credits)+"("+(0,n.v_)(t.theory_credits)+"-"+(0,n.v_)(2*t.practical_credits)+"-"+(0,n.v_)(9-(t.theory_credits+2*t.practical_credits))+") ",1)):(0,r.Q3)("",!0),t.theory_credits+t.practical_credits==6?((0,r.uX)(),(0,r.CE)("td",qs,(0,n.v_)(t.practical_credits+t.theory_credits)+"("+(0,n.v_)(t.theory_credits)+"-"+(0,n.v_)(t.practical_credits)+"-0) ",1)):(0,r.Q3)("",!0),t.group_id?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("td",Ws,(0,n.v_)(t.subject_group_id),1)),t.group_id?((0,r.uX)(),(0,r.CE)("td",Gs,(0,n.v_)(t.group_id),1)):(0,r.Q3)("",!0)])))),128)),(0,r.Lk)("tr",null,[e[8]||(e[8]=(0,r.Lk)("td",{colspan:"2",style:{"text-align":"right"}},"รวมหน่วยกิต:",-1)),(0,r.Lk)("td",null,(0,n.v_)(t.totalCredits),1),e[9]||(e[9]=(0,r.Lk)("td",{colspan:"2"},null,-1))])])]),e[11]||(e[11]=(0,r.Lk)("br",null,null,-1))])))),128)),(0,r.Lk)("h2",null,"หน่วยกิตที่เทียบโอนมา: "+(0,n.v_)(o.totalTransferCredits)+" หน่วยกิตรวมในแผน: "+(0,n.v_)(o.totalAllCredits)+" หน่วยกิตที่ต้องเรียน: 125",1),e[20]||(e[20]=(0,r.Lk)("h4",{style:{"font-weight":"lighter"}},[(0,r.eW)(" ***หมายเหตุ หน่วยกิตที่แสดงประกอบด้วย "),(0,r.Lk)("br"),(0,r.eW)(" ผลรวมของหน่วยกิต(เวลาเรียนภาคทฤษฎี-เวลาเรียนภาคประติบัติ-เวลาเรียนนอกห้องเรียน)")],-1)),1!=i.status&&4!=i.status?((0,r.uX)(),(0,r.CE)("div",Us,[(0,r.Lk)("div",null,[(0,r.Lk)("button",{class:"btn-remove",style:{"font-size":"16px","margin-right":"10px",width:"150px"},onClick:e[0]||(e[0]=(...t)=>o.openRejectPopup&&o.openRejectPopup(...t))},e[12]||(e[12]=[(0,r.Lk)("i",{class:"fa-solid fa-xmark"},null,-1),(0,r.eW)(" ส่งแก้ไขแผน ")])),i.showRejectPopup?((0,r.uX)(),(0,r.CE)("div",Ks,[(0,r.Lk)("div",Ds,[e[13]||(e[13]=(0,r.Lk)("h3",null,"กรุณากรอกสาเหตุที่ต้องการส่งแก้ไขแผน",-1)),(0,r.bo)((0,r.Lk)("textarea",{"onUpdate:modelValue":e[1]||(e[1]=t=>i.rejectReason=t),rows:"4",cols:"50",style:{"font-size":"18px"}},null,512),[[a.Jo,i.rejectReason]]),e[14]||(e[14]=(0,r.Lk)("br",null,null,-1)),(0,r.Lk)("button",{class:"btn-remove",style:{"font-size":"18px","background-color":"#02bd2a","margin-right":"10px"},onClick:e[2]||(e[2]=(...t)=>o.rejectPlan&&o.rejectPlan(...t))},"ยืนยัน"),(0,r.Lk)("button",{class:"btn-remove",style:{"font-size":"18px","background-color":"#a3a3a3"},onClick:e[3]||(e[3]=(...t)=>o.closeRejectPopup&&o.closeRejectPopup(...t))},"ยกเลิก")])])):(0,r.Q3)("",!0)]),(0,r.Lk)("button",{class:"btn-add",style:{"font-size":"16px","background-color":"limegreen",width:"150px"},onClick:e[4]||(e[4]=(...t)=>o.submitPlan&&o.submitPlan(...t))},e[15]||(e[15]=[(0,r.Lk)("i",{class:"fa-solid fa-check"},null,-1),(0,r.eW)(" ยืนยันแผน ")]))])):(0,r.Q3)("",!0),(0,r.Lk)("div",Rs,[(0,r.Lk)("button",{class:"btn-back",style:{"font-size":"16px"},onClick:e[5]||(e[5]=(...t)=>o.goBack&&o.goBack(...t))},e[16]||(e[16]=[(0,r.Lk)("i",{class:"fa-solid fa-arrow-left-long"},null,-1),(0,r.eW)(" กลับ ")])),1!=i.status?((0,r.uX)(),(0,r.CE)("button",{key:0,class:"btn-back",style:{"font-size":"16px","background-color":"blue","margin-right":"25px"},onClick:e[6]||(e[6]=(...t)=>o.editPlan&&o.editPlan(...t))},[(0,r.bF)(c,{icon:["fas","file-pen"]}),e[17]||(e[17]=(0,r.eW)(" แก้ไข "))])):(0,r.Q3)("",!0),1==i.status?((0,r.uX)(),(0,r.CE)("button",{key:1,class:"btn-back",style:{"font-size":"16px","background-color":"#00cc00",width:"200px"},onClick:e[7]||(e[7]=(...t)=>o.openPreviewWindow&&o.openPreviewWindow(...t))},e[18]||(e[18]=[(0,r.Lk)("i",{class:"fa-solid fa-file-pdf"},null,-1),(0,r.eW)(" พิมพ์แผนการเรียน ")]))):(0,r.Q3)("",!0)])])])),_:1})}var Js={name:"tc_inspect_plan",components:{MainLayout:f},data(){return{std_id:this.$route.query.std_id,stdplan_id:this.$route.query.stdplan_id,status:this.$route.query.status,std_name:this.$route.query.std_name,std_last:this.$route.query.std_last,year:this.$route.query.year,std_planlist:[],term:"",groupedPlan:[],selectGroup:"",group_list:[],subject_list:[],selectsubject:"",showRejectPopup:!1,rejectReason:"",transfer_list:[]}},computed:{calculateTotalCredits(){return t=>t.reduce(((t,e)=>{const s=e.theory_credits+e.practical_credits;return t+s}),0)},totalAllCredits(){return this.groupedPlan.reduce(((t,e)=>t+e.totalCredits),0)},totalPracticalCredits(){return this.transfer_list.reduce(((t,e)=>t+Number(e.practical_credits||0)),0)},totalTheoryCredits(){return this.transfer_list.reduce(((t,e)=>t+Number(e.theory_credits||0)),0)},totalTransferCredits(){return this.totalPracticalCredits+this.totalTheoryCredits}},methods:{async fetchStudent_plan(){try{const t=await U.A.post("http://127.0.0.1:3000/api/getStudentplan_list",{std_id:this.std_id});"1"===t.data.result?(console.log(t.data.datalist),this.std_planlist=t.data.datalist,this.groupPlans()):alert("ไม่มีข้อมูลนักศึกษาในระบบ")}catch(t){console.error("Error fetching subjects:",t)}},async fetchTransfer_list(){try{const t=await U.A.post("http://127.0.0.1:3000/api/getTranfer_plan",{std_id:this.std_id});"1"==t.data.result?(console.log("..--..",t.data.datalist),this.transfer_list=t.data.datalist):"0"==t.data.result&&(this.transfer_list=[])}catch(t){console.error("Error fetching subject:",t)}},groupPlans(){const t=[[3,1],[3,2],[3,3],[4,1],[4,2]];this.groupedPlan=t.map((([t,e])=>{const s=this.std_planlist.filter((s=>s.year===t&&s.term===e)),a=s.reduce(((t,e)=>(t+(e.theory_credits+e.practical_credits)>22&&(this.spacialTerm=!0),t+(e.theory_credits+e.practical_credits))),0);return{yearTerm:`${t}-${e}`,year:t,term:3===e?"ภาคฤดูร้อน":e,plans:this.std_planlist.filter((s=>s.year===t&&s.term===e)),totalCredits:a}}))},async submitPlan(){if(confirm("ต้องการยืนยันผลของแผนการเรียนนี้ใช่หรือไม่"))try{const t=await U.A.post("http://127.0.0.1:3000/api/updateStudent_plan",{std_id:this.std_id,stdplan_id:this.stdplan_id,status:1});"1"==t.data.result&&(alert("ยืนยันผลสำเร็จ"),this.$router.push("/submitplan"))}catch(t){console.error("Error fetching subject:",t)}},openRejectPopup(){this.showRejectPopup=!0},closeRejectPopup(){this.showRejectPopup=!1},async rejectPlan(){if(confirm("ต้องการยืนยันผลของแผนการเรียนนี้ใช่หรือไม่"))try{const t=await U.A.post("http://127.0.0.1:3000/api/updateStudent_plan",{std_id:this.std_id,stdplan_id:this.stdplan_id,reason:this.rejectReason,status:2});"1"==t.data.result&&(alert("ยืนยันผลสำเร็จ"),this.$router.push("/submitplan"))}catch(t){console.error("Error fetching subject:",t)}},async editPlan(){this.$router.push({name:"tc_editStudent_plan",query:{std_id:this.std_id,stdplan_id:this.stdplan_id,std_name:this.std_name,std_last:this.std_last,year:this.year}})},openPreviewWindow(){const t=this.std_id,e=this.std_name,s=this.std_last,a=this.year,r=encodeURIComponent("แผนการเรียนรายบุคคล"),l=encodeURIComponent(JSON.stringify(this.std_planlist)),i=`http://127.0.0.1:3000/api/pdf_generate?title=${r}&content=${l}\n               &std_id=${t}&std_name=${e}&std_last=${s}&year=${a}`;window.open(i,"_blank")},goBack(){this.$router.go(-1)}},watch:{selectGroup(t){console.log("Group ID changed:",t),this.fetchSubject()}},mounted(){this.fetchStudent_plan(),this.fetchTransfer_list()}};const Vs=(0,g.A)(Js,[["render",zs]]);var Ms=Vs;const Bs={class:"form-container"},Hs={class:"data-stdplan-table"},Ys={style:{"text-align":"left",width:"450px"}},Zs={key:0},ta={key:1},ea={key:2},sa={key:3},aa={key:4},ra={class:"btn-group"},la={class:"data-stdplan-table",style:{"margin-bottom":"100px"}},ia={style:{"text-align":"left"}};function na(t,e,s,a,l,i){const o=(0,r.g2)("MainLayout");return(0,r.uX)(),(0,r.Wv)(o,null,{default:(0,r.k6)((()=>[(0,r.Lk)("div",Bs,[e[7]||(e[7]=(0,r.Lk)("h1",null,"แผนการเรียนรายบุคคล",-1)),(0,r.Lk)("h2",null,"รหัสนักศึกษา: "+(0,n.v_)(a.user.std_id)+" ชื่อนักศึกษา: "+(0,n.v_)(a.user.std_name)+" "+(0,n.v_)(a.user.std_last),1),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(l.groupedPlan,(t=>((0,r.uX)(),(0,r.CE)("div",{key:t.yearTerm,class:"grouped-table"},[(0,r.Lk)("h2",null,"ภาคเรียนที่ "+(0,n.v_)(t.term)+" ปีการศึกษา "+(0,n.v_)(4===t.year?Number(a.user.batch_year)+1:a.user.batch_year),1),(0,r.Lk)("table",Hs,[e[4]||(e[4]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",null,"รหัสวิชา"),(0,r.Lk)("th",null,"ชื่อวิชา"),(0,r.Lk)("th",null,"หน่วยกิต"),(0,r.Lk)("th",null,"กลุ่มวิชา")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(t.plans,(t=>((0,r.uX)(),(0,r.CE)("tr",{key:t.subject_id},[(0,r.Lk)("td",null,(0,n.v_)(t.subject_id),1),(0,r.Lk)("td",Ys,(0,n.v_)(t.subject_name),1),t.theory_credits+t.practical_credits<3?((0,r.uX)(),(0,r.CE)("td",Zs,(0,n.v_)(t.practical_credits+t.theory_credits)+"("+(0,n.v_)(t.theory_credits)+"-"+(0,n.v_)(2*t.practical_credits)+"-"+(0,n.v_)(3-(t.theory_credits+2*t.practical_credits))+") ",1)):(0,r.Q3)("",!0),t.theory_credits+t.practical_credits>=3&&t.theory_credits+t.practical_credits<=5?((0,r.uX)(),(0,r.CE)("td",ta,(0,n.v_)(t.practical_credits+t.theory_credits)+"("+(0,n.v_)(t.theory_credits)+"-"+(0,n.v_)(2*t.practical_credits)+"-"+(0,n.v_)(9-(t.theory_credits+2*t.practical_credits))+") ",1)):(0,r.Q3)("",!0),t.theory_credits+t.practical_credits==6?((0,r.uX)(),(0,r.CE)("td",ea,(0,n.v_)(t.practical_credits+t.theory_credits)+"("+(0,n.v_)(t.theory_credits)+"-"+(0,n.v_)(t.practical_credits)+"-0) ",1)):(0,r.Q3)("",!0),t.group_id?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("td",sa,(0,n.v_)(t.subject_group_id),1)),t.group_id?((0,r.uX)(),(0,r.CE)("td",aa,(0,n.v_)(t.group_id),1)):(0,r.Q3)("",!0)])))),128)),(0,r.Lk)("tr",null,[e[2]||(e[2]=(0,r.Lk)("td",{colspan:"2",style:{"text-align":"right"}},"รวมหน่วยกิต:",-1)),(0,r.Lk)("td",null,(0,n.v_)(t.totalCredits),1),e[3]||(e[3]=(0,r.Lk)("td",{colspan:"2"},null,-1))])])])])))),128)),e[8]||(e[8]=(0,r.Lk)("h4",{style:{"font-weight":"lighter"}},[(0,r.eW)(" ***หมายเหตุ หน่วยกิตที่แสดงประกอบด้วย "),(0,r.Lk)("br"),(0,r.eW)(" ผลรวมของหน่วยกิต(เวลาเรียนภาคทฤษฎี-เวลาเรียนภาคประติบัติ-เวลาเรียนนอกห้องเรียน)")],-1)),(0,r.Lk)("h2",null,"หน่วยกิตเทียบมา: "+(0,n.v_)(i.totalTransferCredits)+" หน่วยกิตรวมในแผน: "+(0,n.v_)(i.totalAllCredits)+" หน่วยกิตรวมทั้งหมด: "+(0,n.v_)(i.totalTransferCredits+i.totalAllCredits),1),(0,r.Lk)("div",ra,[(0,r.Lk)("button",{class:"btn-back",style:{"font-size":"16px","background-color":"#00a3cc",width:"200px"},onClick:e[0]||(e[0]=(...t)=>i.goToChangePlan&&i.goToChangePlan(...t))}," ขอปรับแผนการเรียน "),(0,r.Lk)("button",{class:"btn-back",style:{"font-size":"16px","background-color":"#00cc00",width:"200px"},onClick:e[1]||(e[1]=(...t)=>i.openPreviewWindow&&i.openPreviewWindow(...t))},e[5]||(e[5]=[(0,r.Lk)("i",{class:"fa-solid fa-file-pdf"},null,-1),(0,r.eW)(" พิมพ์แผนการเรียน ")]))]),e[9]||(e[9]=(0,r.Lk)("h2",null,"รายวิชาเทียบโอน",-1)),(0,r.Lk)("table",la,[e[6]||(e[6]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",null,"รหัสวิชา"),(0,r.Lk)("th",null,"ชื่อวิชา"),(0,r.Lk)("th",null,"หน่วยกิต")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(l.transfer_list,(t=>((0,r.uX)(),(0,r.CE)("tr",{key:t._id},[(0,r.Lk)("td",null,(0,n.v_)(t.subject_id),1),(0,r.Lk)("td",ia,(0,n.v_)(t.subject_name),1),(0,r.Lk)("td",null,(0,n.v_)(t.practical_credits+t.theory_credits),1)])))),128))])])])])),_:1})}var oa={setup(){const t=(0,r.WQ)("user"),e=(0,r.EW)((()=>t?.value||{}));return console.log("User Data:",e.value),{user:e}},name:"student_plan_page",components:{MainLayout:f},data(){return{std_id:"",stdplan_id:"",status:"",std_name:"",std_last:"",year:"",std_planlist:[],groupedPlan:[],group_list:[],transfer_list:[],adjust_list:[]}},computed:{totalAllCredits(){return this.groupedPlan.reduce(((t,e)=>t+e.totalCredits),0)},totalPracticalCredits(){return this.transfer_list.reduce(((t,e)=>t+Number(e.practical_credits||0)),0)},totalTheoryCredits(){return this.transfer_list.reduce(((t,e)=>t+Number(e.theory_credits||0)),0)},totalTransferCredits(){return this.totalPracticalCredits+this.totalTheoryCredits}},methods:{async fetchStudent_plan(){try{const t=await U.A.post("http://127.0.0.1:3000/api/getStudentplan_list",{std_id:this.user.std_id});"1"===t.data.result&&(console.log(t.data.datalist),this.std_planlist=t.data.datalist,this.groupPlans())}catch(t){console.error("Error fetching subjects:",t)}},async fetchTransfer_list(){try{const t=await U.A.post("http://127.0.0.1:3000/api/getTranfer_plan",{std_id:this.user.std_id});"1"==t.data.result?(console.log("..--..",t.data.datalist),this.transfer_list=t.data.datalist):"0"==t.data.result&&(this.transfer_list=[])}catch(t){console.error("Error fetching subject:",t)}},async fetchAdjust_list(){try{const t=await U.A.post("http://127.0.0.1:3000/api/getAdjust_list",{std_id:this.user.std_id});"1"===t.data.result&&(console.log(t.data.datalist),this.adjust_list=t.data.datalist)}catch{}},groupPlans(){const t=[[3,1],[3,2],[3,3],[4,1],[4,2]];this.groupedPlan=t.map((([t,e])=>{const s=this.std_planlist.filter((s=>s.year===t&&s.term===e)),a=s.reduce(((t,e)=>(t+(e.theory_credits+e.practical_credits)>22&&(this.spacialTerm=!0),t+(e.theory_credits+e.practical_credits))),0);return{yearTerm:`${t}-${e}`,year:t,term:3===e?"ภาคฤดูร้อน":e,plans:this.std_planlist.filter((s=>s.year===t&&s.term===e)),totalCredits:a}}))},openPreviewWindow(){const t=this.user.std_id,e=this.user.std_name,s=this.user.std_last,a=this.user.batch_year,r=encodeURIComponent("แผนการเรียนรายบุคคล"),l=encodeURIComponent(JSON.stringify(this.std_planlist)),i=`http://127.0.0.1:3000/api/pdf_generate?title=${r}&content=${l}\n               &std_id=${t}&std_name=${e}&std_last=${s}&year=${a}`;window.open(i,"_blank")},goToChangePlan(){const t=this.adjust_list.find((t=>0===t.status));t?alert("ไม่สามารถขอปรับแผนการเรียนได้เนื่องจากมีการขอปรับที่รอพิจารณาอยู่"):this.$router.push("/student_change_plan")}},mounted(){this.fetchStudent_plan(),this.fetchTransfer_list(),this.fetchAdjust_list()}};const ca=(0,g.A)(oa,[["render",na]]);var ua=ca;const da={class:"form-container"},_a={key:0,class:"popup-overlay"},pa={class:"popup-content"},ha={class:"dropdown-container",style:{width:"600px"}},ya={key:0},ka={class:"data-stdplan-table"},ba={key:0},ga={key:0,style:{"text-align":"left",width:"450px"}},ma={key:1,style:{"text-align":"left",width:"450px"}},fa={key:2},La={key:3},va={key:4},Ca=["onClick"],ja={class:"btn-group"},Ea={class:"data-stdplan-table",style:{"margin-bottom":"100px"}},wa={colspan:"7",style:{"text-align":"left"}},Sa={key:0,style:{color:"#ff1a1a"}},xa={style:{"text-align":"left"}},Xa={key:1,style:{color:"#33cc33"}},Pa={style:{"text-align":"left"}};function Ta(t,e,s,l,i,o){const c=(0,r.g2)("MainLayout");return(0,r.uX)(),(0,r.Wv)(c,null,{default:(0,r.k6)((()=>[(0,r.Lk)("div",da,[e[21]||(e[21]=(0,r.Lk)("h1",null,"ขอปรับแผนการเรียน",-1)),(0,r.Lk)("h2",null," รหัสนักศึกษา: "+(0,n.v_)(l.user.std_id)+" ชื่อนักศึกษา: "+(0,n.v_)(l.user.std_name)+" "+(0,n.v_)(l.user.std_last),1),i.change_popup?((0,r.uX)(),(0,r.CE)("div",_a,[(0,r.Lk)("div",pa,[(0,r.Lk)("h3",null,"ย้ายรายวิชา "+(0,n.v_)(i.sub_name)+" ไป",1),(0,r.Lk)("div",ha,[(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>i.select_year=t),id:"year"},e[7]||(e[7]=[(0,r.Lk)("option",{value:"",disabled:""},"เลือกปี",-1),(0,r.Lk)("option",{value:"3"},"ปี 3",-1),(0,r.Lk)("option",{value:"4"},"ปี 4",-1)]),512),[[a.u1,i.select_year]]),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>i.select_term=t),id:"term"},[e[8]||(e[8]=(0,r.Lk)("option",{value:"",disabled:""},"เลือกเทอม",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.open_subject,(t=>((0,r.uX)(),(0,r.CE)(r.FK,{key:t.subject_id},[t.subject_id===i.sub_id?((0,r.uX)(),(0,r.CE)("option",ya,(0,n.v_)(t.term),1)):(0,r.Q3)("",!0)],64)))),128))],512),[[a.u1,i.select_term]])]),(0,r.Lk)("button",{class:"btn-remove",style:{"font-size":"18px","background-color":"#00ff00","margin-right":"10px"},onClick:e[2]||(e[2]=(...t)=>o.update_plan&&o.update_plan(...t))},"ยืนยัน"),(0,r.Lk)("button",{class:"btn-remove",style:{"font-size":"18px","background-color":"#a3a3a3"},onClick:e[3]||(e[3]=(...t)=>o.closePopup&&o.closePopup(...t))},"ยกเลิก")])])):(0,r.Q3)("",!0),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.groupedPlan,(t=>((0,r.uX)(),(0,r.CE)("div",{key:t.yearTerm,class:"grouped-table"},[(0,r.Lk)("h2",null,"ภาคเรียนที่ "+(0,n.v_)(t.term)+" ปีการศึกษา "+(0,n.v_)(4===t.year?Number(l.user.batch_year)+1:l.user.batch_year),1),(0,r.Lk)("table",ka,[(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[e[9]||(e[9]=(0,r.Lk)("th",null,"รหัสวิชา",-1)),e[10]||(e[10]=(0,r.Lk)("th",null,"ชื่อวิชา",-1)),e[11]||(e[11]=(0,r.Lk)("th",null,"หน่วยกิต",-1)),e[12]||(e[12]=(0,r.Lk)("th",null,"กลุ่มวิชา",-1)),t?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("th",ba))])]),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(t.plans,(t=>((0,r.uX)(),(0,r.CE)("tr",{key:t.subject_id,class:(0,n.C4)({changed:t.hasChanged})},[(0,r.Lk)("td",null,(0,n.v_)(t.subject_id),1),t.subject_name?((0,r.uX)(),(0,r.CE)("td",ga,(0,n.v_)(t.subject_name),1)):((0,r.uX)(),(0,r.CE)("td",ma,(0,n.v_)(t.subject_nameTh),1)),t.theory_credits+t.practical_credits<3?((0,r.uX)(),(0,r.CE)("td",fa,(0,n.v_)(t.practical_credits+t.theory_credits)+" ("+(0,n.v_)(t.theory_credits)+"-"+(0,n.v_)(2*t.practical_credits)+"-"+(0,n.v_)(3-(t.theory_credits+2*t.practical_credits))+") ",1)):t.theory_credits+t.practical_credits<=5?((0,r.uX)(),(0,r.CE)("td",La,(0,n.v_)(t.practical_credits+t.theory_credits)+" ("+(0,n.v_)(t.theory_credits)+"-"+(0,n.v_)(2*t.practical_credits)+"-"+(0,n.v_)(9-(t.theory_credits+2*t.practical_credits))+") ",1)):((0,r.uX)(),(0,r.CE)("td",va,(0,n.v_)(t.practical_credits+t.theory_credits)+" ("+(0,n.v_)(t.theory_credits)+"-"+(0,n.v_)(t.practical_credits)+"-0) ",1)),(0,r.Lk)("td",null,(0,n.v_)(t.group_id),1),(0,r.Lk)("td",null,[(0,r.Lk)("button",{class:"btn-remove",onClick:e=>o.openChangePopup(t.subject_name,t.subject_id),style:{"background-color":"#00ccff","margin-right":"10px"}},e[13]||(e[13]=[(0,r.Lk)("i",{class:"fa-solid fa-repeat"},null,-1)]),8,Ca)])],2)))),128)),(0,r.Lk)("tr",null,[e[14]||(e[14]=(0,r.Lk)("td",{colspan:"2",style:{"text-align":"right"}},"รวมหน่วยกิต:",-1)),(0,r.Lk)("td",null,(0,n.v_)(t.totalCredits),1),e[15]||(e[15]=(0,r.Lk)("td",{colspan:"2"},null,-1))])])]),e[16]||(e[16]=(0,r.Lk)("br",null,null,-1))])))),128)),e[22]||(e[22]=(0,r.Lk)("h4",{style:{"font-weight":"lighter"}},[(0,r.eW)(" ***หมายเหตุ หน่วยกิตที่แสดงประกอบด้วย "),(0,r.Lk)("br"),(0,r.eW)(" ผลรวมของหน่วยกิต(เวลาเรียนภาคทฤษฎี-เวลาเรียนภาคประติบัติ-เวลาเรียนนอกห้องเรียน)")],-1)),(0,r.Lk)("h2",null,"หน่วยกิตเทียบได้: "+(0,n.v_)(o.totalTransferCredits)+" หน่วยกิตรวมในแผน: "+(0,n.v_)(o.totalAllCredits)+" หน่วยกิตที่ต้องเรียน: 125",1),(0,r.Lk)("div",ja,[(0,r.Lk)("button",{class:"btn-back",style:{"font-size":"20px",width:"200px"},onClick:e[4]||(e[4]=(...t)=>o.goBack&&o.goBack(...t))},e[17]||(e[17]=[(0,r.Lk)("i",{class:"fa-solid fa-arrow-left-long"}," กลับ",-1)])),(0,r.Lk)("button",{class:"btn-back",style:{"font-size":"20px","background-color":"#3385ff",width:"200px"},onClick:e[5]||(e[5]=(...t)=>o.resetChanges&&o.resetChanges(...t))},e[18]||(e[18]=[(0,r.Lk)("i",{class:"fa-solid fa-arrow-rotate-left"}," รีเซ็ตแผน",-1)])),(0,r.Lk)("button",{class:"btn-back",style:{"font-size":"20px","background-color":"#33cc33",width:"200px"},onClick:e[6]||(e[6]=t=>o.saveChanges(l.user.std_id))},e[19]||(e[19]=[(0,r.Lk)("i",{class:"fa-solid fa-floppy-disk"}," บันทึกแผน",-1)]))]),e[23]||(e[23]=(0,r.Lk)("h2",null,"สรุปแผนการเรียนทั้งหมด",-1)),(0,r.Lk)("table",Ea,[e[20]||(e[20]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",null,"กลุ่มวิชา"),(0,r.Lk)("th",null,"หน่วยกิตที่ต้องเรียน"),(0,r.Lk)("th",null,"เทียบโอนได้"),(0,r.Lk)("th",null,"ในแผน"),(0,r.Lk)("th",null,"หน่วยกิตรวม"),(0,r.Lk)("th",null,"ขาด")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.credit_status,((t,e)=>((0,r.uX)(),(0,r.CE)(r.FK,{key:e},[(0,r.Lk)("tr",null,[(0,r.Lk)("td",wa,[(0,r.Lk)("strong",null,(0,n.v_)(e),1)])]),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(t,(t=>((0,r.uX)(),(0,r.CE)(r.FK,{key:t._id},["❌"==t.status?((0,r.uX)(),(0,r.CE)("tr",Sa,[(0,r.Lk)("td",xa,(0,n.v_)(t.group_id+" "+t.group_name),1),(0,r.Lk)("td",null,(0,n.v_)(t.required_credits),1),(0,r.Lk)("td",null,(0,n.v_)(t.tranfer_credits),1),(0,r.Lk)("td",null,(0,n.v_)(t.need_credit),1),(0,r.Lk)("td",null,(0,n.v_)(t.earned_credits),1),(0,r.Lk)("td",null,(0,n.v_)(t.credit_isneed),1)])):((0,r.uX)(),(0,r.CE)("tr",Xa,[(0,r.Lk)("td",Pa,(0,n.v_)(t.group_id+" "+t.group_name),1),(0,r.Lk)("td",null,(0,n.v_)(t.required_credits),1),(0,r.Lk)("td",null,(0,n.v_)(t.tranfer_credits),1),(0,r.Lk)("td",null,(0,n.v_)(t.need_credit),1),(0,r.Lk)("td",null,(0,n.v_)(t.earned_credits),1),(0,r.Lk)("td",null,(0,n.v_)(t.credit_isneed),1)]))],64)))),128))],64)))),128))])])])])),_:1})}var Aa={setup(){const t=(0,r.WQ)("user"),e=(0,r.EW)((()=>t?.value||{}));return console.log("User Data:",e.value),{user:e}},name:"std_changePlan_page",components:{MainLayout:f},computed:{calculateTotalCredits(){return t=>t.reduce(((t,e)=>{const s=e.theory_credits+e.practical_credits;return t+s}),0)},totalAllCredits(){return this.groupedPlan.reduce(((t,e)=>t+e.totalCredits),0)},filteredGroups(){return t=>("ภาคฤดูร้อน"==t&&(t=3),this.group_list.filter((e=>this.open_subject.some((s=>s.group_id===e.group_id&&s.term==t)))))},credit_status(){return this.group_list.reduce(((t,e)=>(t[e.sort]||(t[e.sort]=[]),t[e.sort].push(e),t)),{})},totalPracticalCredits(){return this.transfer_list.reduce(((t,e)=>t+Number(e.practical_credits||0)),0)},totalTheoryCredits(){return this.transfer_list.reduce(((t,e)=>t+Number(e.theory_credits||0)),0)},totalTransferCredits(){return this.totalPracticalCredits+this.totalTheoryCredits}},data(){return{std_planlist:[],temp_planlist:[],term:"",groupedPlan:[],group_list:[],subject_list:[],plans_list:[],spacialTerm:!1,open_subject:[],transfer_list:[],change_popup:!1,sub_name:"",sub_id:"",select_term:"",select_year:""}},methods:{openChangePopup(t,e){this.sub_name=t,this.sub_id=e,this.change_popup=!0},closePopup(){this.change_popup=!1},async fetchOpen_subject(){console.log(this.selectGroup);try{const t=await U.A.post("http://127.0.0.1:3000/api/getopensubject",{group_id:this.selectGroup});"1"==t.data.result?(this.open_subject=t.data.datalist,this.groupPlans()):"2"==t.data.result&&(this.open_subject=[],this.groupPlans())}catch(t){console.error("Error fetching subject:",t)}},async fetchTransfer_list(){try{const t=await U.A.post("http://127.0.0.1:3000/api/getTranfer_plan",{std_id:this.user.std_id});"1"==t.data.result?this.transfer_list=t.data.datalist:"0"==t.data.result&&(this.transfer_list=[])}catch(t){console.error("Error fetching subject:",t)}},async fetchStudent_plan(){try{const t=await U.A.post("http://127.0.0.1:3000/api/getStudentplan_list",{std_id:this.user.std_id});"1"===t.data.result?(this.std_planlist=t.data.datalist,this.temp_planlist=JSON.parse(JSON.stringify(this.std_planlist)),this.groupPlans()):"0"===t.data.result&&(this.std_planlist=[],this.temp_planlist=[],this.groupPlans())}catch(t){console.error("Error fetching subjects:",t)}},async fetchStructure(){try{const t=await U.A.get("http://127.0.0.1:3000/api/getStructure",{});this.group_list=t.data.datalist,this.mergeCredits()}catch(t){console.error("Error fetching subject:",t)}},async fetchSubject(){try{if(!this.selectGroup)return void(this.subject_list=[]);const t=await U.A.post("http://127.0.0.1:3000/api/getSubject",{group_id:this.selectGroup});"1"==t.data.result?this.subject_list=t.data.datalist:alert("ไม่มีข้อมูลวิชาในกลุ่มที่เลือก")}catch(t){console.error("Error fetching subject:",t)}},update_plan(){let t=this.temp_planlist.filter((t=>t.year===Number(this.select_year)&&t.term===Number(this.select_term)));console.log("Filtered Plans:",t);let e=t.reduce(((t,e)=>t+Number(e.practical_credits||0)),0),s=t.reduce(((t,e)=>t+Number(e.theory_credits||0)),0),a=this.open_subject.find((t=>t.subject_id===String(this.sub_id)));if(!a)return void alert("ไม่พบวิชาที่เลือก กรุณาลองใหม่");let r=Number(a.practical_credits),l=Number(a.theory_credits),i=e+s,n=i+r,o=i+l;if(console.log(`New Practical Credits: ${n}, New Theory Credits: ${o}`),confirm("ต้องการที่จะย้ายวิชานี้ใช่หรือไม่")){if(n>25||o>25)return void alert("ไม่สามารถเพิ่มได้ เนื่องจากหน่วยกิตรวมเกิน 25");if((n>22||o>22)&&1==this.spacialTerm)return void alert("ไม่สามารถเพิ่มได้ เนื่องจากมีเทอมที่หน่วยกิตเกิน 25 แล้ว");if((n>=22||o>22)&&!confirm("หน่วยกิตในเทอมเกิน 22 ต้องการดำเนินการต่อหรือไม่?"))return;let t=this.temp_planlist.find((t=>t.subject_id===this.sub_id));t?(t.year=Number(this.select_year),t.term=Number(this.select_term),t.hasChanged=!0,console.log("อัปเดตข้อมูลใน temp_planlist สำเร็จ"),this.change_popup=!1):alert("ไม่พบรายวิชานี้ในแผนการเรียน"),this.groupPlans(),this.mergeCredits()}},resetChanges(){this.temp_planlist=JSON.parse(JSON.stringify(this.std_planlist)),this.groupPlans(),alert("รีเซ็ตข้อมูลเรียบร้อยแล้ว!")},async saveChanges(t){if(confirm("คุณต้องการบันทึกการเปลี่ยนแปลงหรือไม่?"))try{let e=Array.isArray(this.temp_planlist)?this.temp_planlist:[this.temp_planlist],s=Array.isArray(this.std_planlist)?this.std_planlist:[this.std_planlist],a=e.map((t=>{let e=s.find((e=>e.subject_id===t.subject_id&&e.term===t.term&&e.year===t.year&&e.group_id===t.group_id));if(!e)return{...t};let a={};return Object.keys(t).forEach((s=>{t[s]!==e[s]&&(a[s]=t[s])})),Object.keys(a).length>0?{plan_id:t.plan_id,...a}:null})).filter((t=>null!==t));if(0===a.length)return void alert("ไม่มีข้อมูลที่เปลี่ยนแปลง");{console.log("ข้อมูลที่เปลี่ยนแปลง:",a);const e=await U.A.post("http://127.0.0.1:3000/api/setAdjustplan_list",{std_id:t,plans:a});"1"===e.data.result?(alert("บันทึกสำเร็จ!"),this.std_planlist=JSON.parse(JSON.stringify(this.temp_planlist)),this.$router.push("/")):"2"===e.data.result?alert("ไม่สามารถขอปรับแผนการเรียนได้เนื่องจากมีการขอปรับที่รอพิจารณาอยู่"):alert("เกิดข้อผิดพลาดในการบันทึกข้อมูล")}}catch(e){console.error("Error saving changes:",e)}},groupPlans(){const t=[[3,1],[3,2],[3,3],[4,1],[4,2]];this.groupedPlan=t.map((([t,e])=>{const s=this.temp_planlist.filter((s=>s.year===t&&s.term===e)),a=s.reduce(((t,e)=>(t+(e.theory_credits+e.practical_credits)>22&&(this.spacialTerm=!0),t+(e.theory_credits+e.practical_credits))),0);return{yearTerm:`${t}-${e}`,year:t,term:3===e?"ภาคฤดูร้อน":e,plans:this.temp_planlist.filter((s=>s.year===t&&s.term===e)),totalCredits:a,open:this.open_subject.filter((t=>t.term===e))}}))},mergeCredits(){this.group_list=this.group_list.map((t=>{let e=this.temp_planlist.filter((e=>String(e.group_id)===String(t.group_id))),s=this.transfer_list.filter((e=>String(e.group_id)===String(t.group_id))),a=e.reduce(((t,e)=>t+(e.theory_credits+e.practical_credits)),0),r=s.reduce(((t,e)=>t+(e.theory_credits+e.practical_credits)),0),l=a+r,i=t.credit-l;i<0&&(i=0);let n=l>=t.credit?"✔️":"❌";return{...t,_id:Date.now().toString(),required_credits:t.credit,tranfer_credits:r,need_credit:a,earned_credits:l,credit_isneed:i,status:n}}))},goBack(){this.$router.go(-1)}},watch:{selectGroup(t){console.log("Group ID changed:",t),this.selectGroup_id=t,this.fetchOpen_subject()},selectPlan(t){this.selectPlan=t,this.fetchStandardPlan_list()},temp_planlist(t){console.log("temp_planlist changed:",t),this.mergeCredits()}},async mounted(){await this.fetchStudent_plan(),await this.fetchTransfer_list(),await this.fetchSubject(),await this.fetchOpen_subject(),this.fetchStructure()}};const Qa=(0,g.A)(Aa,[["render",Ta]]);var $a=Qa;const Na={class:"form-container"},Oa={key:0,class:"data-stdplan-table",style:{width:"1000px","margin-left":"auto","margin-right":"auto"}},Fa={style:{"text-align":"left"}},Ia={key:0,style:{color:"green"}},qa={key:1,style:{color:"red"}},Wa={key:2,style:{color:"blue"}},Ga=["onClick"],Ua={key:1};function Ka(t,e,s,a,l,i){const o=(0,r.g2)("MainLayout");return(0,r.uX)(),(0,r.Wv)(o,null,{default:(0,r.k6)((()=>[(0,r.Lk)("div",Na,[e[2]||(e[2]=(0,r.Lk)("h1",null,"อนุมัติขอปรับแผนการเรียน",-1)),l.student_list?((0,r.uX)(),(0,r.CE)("table",Oa,[e[1]||(e[1]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",null,"รหัสนักศึกษา"),(0,r.Lk)("th",null,"ชื่อ"),(0,r.Lk)("th",null,"รุ่นปี"),(0,r.Lk)("th",null,"วันที่ขอปรับ"),(0,r.Lk)("th",null,"วันที่พิจารณา"),(0,r.Lk)("th",null,"ผู้พิจารณา"),(0,r.Lk)("th",null,"สถานะ"),(0,r.Lk)("th")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(l.student_list,(t=>((0,r.uX)(),(0,r.CE)("tr",{key:t.std_id},[(0,r.Lk)("td",null,(0,n.v_)(t.std_id),1),(0,r.Lk)("td",Fa,(0,n.v_)(t.std_name)+" "+(0,n.v_)(t.std_last),1),(0,r.Lk)("td",null,(0,n.v_)(t.batch_year),1),(0,r.Lk)("td",null,(0,n.v_)(t.date_add),1),(0,r.Lk)("td",null,(0,n.v_)(t.date_updated||"-"),1),(0,r.Lk)("td",null,(0,n.v_)(t.user_ap||"-"),1),1==t.status?((0,r.uX)(),(0,r.CE)("td",Ia,(0,n.v_)(i.convertStatusToText(t.status)),1)):(0,r.Q3)("",!0),2==t.status?((0,r.uX)(),(0,r.CE)("td",qa,(0,n.v_)(i.convertStatusToText(t.status)),1)):(0,r.Q3)("",!0),0==t.status?((0,r.uX)(),(0,r.CE)("td",Wa,(0,n.v_)(i.convertStatusToText(t.status)),1)):(0,r.Q3)("",!0),(0,r.Lk)("td",null,[0==t.status?((0,r.uX)(),(0,r.CE)("button",{key:0,class:"btn-add",style:{"font-size":"16px",width:"100px"},onClick:e=>i.inspectAdjust(t.std_id,t.std_name,t.std_last,t.batch_year,t.adjust_id)},e[0]||(e[0]=[(0,r.Lk)("i",{class:"fa-solid fa-magnifying-glass"},null,-1)]),8,Ga)):(0,r.Q3)("",!0)])])))),128))])])):(0,r.Q3)("",!0),0==l.student_list.length?((0,r.uX)(),(0,r.CE)("p",Ua,"ไม่พบข้อมูลขอปรับแผนการเรียน")):(0,r.Q3)("",!0),e[3]||(e[3]=(0,r.Lk)("br",null,null,-1))])])),_:1})}var Da={name:"tc_adjust_list",components:{MainLayout:f},data(){return{student_list:[]}},methods:{async fetchAdjust_list(){try{const t=await U.A.get("http://127.0.0.1:3000/api/getAdjust_list");if("1"===t.data.result){console.log(t.data.datalist),this.student_list=t.data.datalist;const e=this.student_list.sort(((t,e)=>{const s=this.convert_date(t.date_add),a=this.convert_date(e.date_add);return a-s}));this.student_list=e}}catch(t){console.error("Error fetching change plan:",t)}},convert_date(t){const[e,s,a]=t.split("-").map(Number),r=a-543;return new Date(r,s-1,e)},convertStatusToText(t){const e={1:"ยืนยัน",2:"ปฏิเสธ",0:"รอพิจารณา"};return e[t]||"สถานะไม่ทราบ"},async inspectAdjust(t,e,s,a,r){this.$router.push({name:"tc_inspect_adjust",query:{std_id:t,std_name:e,std_last:s,year:a,adjust_id:r}})}},mounted(){this.fetchAdjust_list()}};const Ra=(0,g.A)(Da,[["render",Ka]]);var za=Ra;const Ja={class:"form-container"},Va={key:0,class:"popup-overlay"},Ma={class:"popup-content"},Ba={key:0,class:"table-headers"},Ha={class:"tables-wrapper"},Ya={class:"tables-container"},Za={class:"data-table"},tr={style:{"text-align":"center"}},er={class:"data-table"},sr={style:{"text-align":"center"}},ar={class:"btn-group",style:{"margin-bottom":"100px",display:"flex","justify-content":"center",gap:"500px"}};function rr(t,e,s,l,i,o){const c=(0,r.g2)("MainLayout");return(0,r.uX)(),(0,r.Wv)(c,null,{default:(0,r.k6)((()=>[(0,r.Lk)("div",Ja,[e[6]||(e[6]=(0,r.Lk)("h2",null,"ตรวจสอบแผนการเรียน",-1)),(0,r.Lk)("h3",null,"รหัสนักศึกษา: "+(0,n.v_)(i.std_id)+" ชื่อ: "+(0,n.v_)(i.std_name)+" "+(0,n.v_)(i.std_last),1)]),i.showRejectPopup?((0,r.uX)(),(0,r.CE)("div",Va,[(0,r.Lk)("div",Ma,[e[7]||(e[7]=(0,r.Lk)("h3",null,"กรอกสาเหตุที่ต้องปฏิเสธแผนนี้",-1)),(0,r.bo)((0,r.Lk)("textarea",{"onUpdate:modelValue":e[0]||(e[0]=t=>i.rejectReason=t),rows:"4",cols:"50",style:{"font-size":"18px"}},null,512),[[a.Jo,i.rejectReason]]),e[8]||(e[8]=(0,r.Lk)("br",null,null,-1)),(0,r.Lk)("button",{class:"btn-remove",style:{"font-size":"18px","margin-right":"10px","background-color":"#02bd2a"},onClick:e[1]||(e[1]=(...t)=>o.rejectPlan&&o.rejectPlan(...t))},"ยืนยัน"),(0,r.Lk)("button",{class:"btn-remove",style:{"font-size":"18px","background-color":"#a3a3a3"},onClick:e[2]||(e[2]=(...t)=>o.closeRejectPopup&&o.closeRejectPopup(...t))},"ยกเลิก")])])):(0,r.Q3)("",!0),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.groupedOriData,((t,s)=>((0,r.uX)(),(0,r.CE)("div",{key:"group-"+t.yearTerm},[3===t.year&&1===t.term?((0,r.uX)(),(0,r.CE)("div",Ba,e[9]||(e[9]=[(0,r.Lk)("h3",null,"แผนการเรียนเดิม",-1),(0,r.Lk)("h3",null,"แผนการเรียนใหม่",-1)]))):(0,r.Q3)("",!0),(0,r.Lk)("h3",null,"เทอม "+(0,n.v_)(t.term)+" ปีการศึกษา "+(0,n.v_)(4===t.year?Number(i.year)+1:i.year),1),(0,r.Lk)("div",Ha,[(0,r.Lk)("div",Ya,[(0,r.Lk)("div",null,[(0,r.Lk)("table",Za,[e[11]||(e[11]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",null,"รหัสวิชา"),(0,r.Lk)("th",null,"ชื่อวิชา"),(0,r.Lk)("th",null,"กลุ่มวิชา"),(0,r.Lk)("th",null,"หน่วยกิต")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(t.plans,(t=>((0,r.uX)(),(0,r.CE)("tr",{key:"ori-"+t.subject_id},[(0,r.Lk)("td",{style:(0,n.Tr)(o.checkHasChanges(t,"ori")?{backgroundColor:"#cccccc"}:{})},(0,n.v_)(t.subject_id),5),(0,r.Lk)("td",{style:(0,n.Tr)(o.checkHasChanges(t,"ori")?{backgroundColor:"#cccccc",width:"400px",hight:"20px"}:{width:"400px"})},(0,n.v_)(t.subject_name),5),(0,r.Lk)("td",{style:(0,n.Tr)(o.checkHasChanges(t,"ori")?{backgroundColor:"#cccccc",textAlign:"center"}:{textAlign:"center"})},(0,n.v_)(t.group_id||"-"),5),t.theory_credits+t.practical_credits<3?((0,r.uX)(),(0,r.CE)("td",{key:0,style:(0,n.Tr)(o.checkHasChanges(t,"ori")?{backgroundColor:"#cccccc"}:{})},(0,n.v_)(t.practical_credits+t.theory_credits)+"("+(0,n.v_)(t.theory_credits)+"-"+(0,n.v_)(2*t.practical_credits)+"-"+(0,n.v_)(3-(t.theory_credits+2*t.practical_credits))+") ",5)):(0,r.Q3)("",!0),t.theory_credits+t.practical_credits>=3&&t.theory_credits+t.practical_credits<=5?((0,r.uX)(),(0,r.CE)("td",{key:1,style:(0,n.Tr)(o.checkHasChanges(t,"ori")?{backgroundColor:"#cccccc"}:{})},(0,n.v_)(t.practical_credits+t.theory_credits)+"("+(0,n.v_)(t.theory_credits)+"-"+(0,n.v_)(2*t.practical_credits)+"-"+(0,n.v_)(9-(t.theory_credits+2*t.practical_credits))+") ",5)):(0,r.Q3)("",!0),t.theory_credits+t.practical_credits==6?((0,r.uX)(),(0,r.CE)("td",{key:2,style:(0,n.Tr)(o.checkHasChanges(t,"ori")?{backgroundColor:"#cccccc"}:{})},(0,n.v_)(t.practical_credits+t.theory_credits)+"("+(0,n.v_)(t.theory_credits)+"-"+(0,n.v_)(t.practical_credits)+"-0) ",5)):(0,r.Q3)("",!0)])))),128)),(0,r.Lk)("tr",null,[e[10]||(e[10]=(0,r.Lk)("td",{colspan:"3",style:{"text-align":"right"}},"รวมหน่วยกิต:",-1)),(0,r.Lk)("td",tr,(0,n.v_)(o.totalCreditsOriData[s]?.totalCredits),1)])])])]),(0,r.Lk)("div",null,[(0,r.Lk)("table",er,[e[13]||(e[13]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",null,"รหัสวิชา"),(0,r.Lk)("th",null,"ชื่อวิชา"),(0,r.Lk)("th",null,"กลุ่มวิชา"),(0,r.Lk)("th",null,"หน่วยกิต")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.groupedChangeData[s]?.plans||[],(t=>((0,r.uX)(),(0,r.CE)("tr",{key:"change-"+t.subject_id},[(0,r.Lk)("td",{class:(0,n.C4)({changed:t.hasChanges})},(0,n.v_)(t.subject_id),3),(0,r.Lk)("td",{class:(0,n.C4)({changed:t.hasChanges}),style:{width:"400px",hight:"20px"}},(0,n.v_)(t.subject_name),3),(0,r.Lk)("td",{class:(0,n.C4)({changed:t.hasChanges}),style:{textAlign:"center"}},(0,n.v_)(t.group_id||"-"),3),t.theory_credits+t.practical_credits<3?((0,r.uX)(),(0,r.CE)("td",{key:0,class:(0,n.C4)({changed:t.hasChanges})},(0,n.v_)(t.practical_credits+t.theory_credits)+"("+(0,n.v_)(t.theory_credits)+"-"+(0,n.v_)(2*t.practical_credits)+"-"+(0,n.v_)(3-(t.theory_credits+2*t.practical_credits))+") ",3)):(0,r.Q3)("",!0),t.theory_credits+t.practical_credits>=3&&t.theory_credits+t.practical_credits<=5?((0,r.uX)(),(0,r.CE)("td",{key:1,class:(0,n.C4)({changed:t.hasChanges})},(0,n.v_)(t.practical_credits+t.theory_credits)+"("+(0,n.v_)(t.theory_credits)+"-"+(0,n.v_)(2*t.practical_credits)+"-"+(0,n.v_)(9-(t.theory_credits+2*t.practical_credits))+") ",3)):(0,r.Q3)("",!0),t.theory_credits+t.practical_credits==6?((0,r.uX)(),(0,r.CE)("td",{key:2,class:(0,n.C4)({changed:t.hasChanges})},(0,n.v_)(t.practical_credits+t.theory_credits)+"("+(0,n.v_)(t.theory_credits)+"-"+(0,n.v_)(t.practical_credits)+"-0) ",3)):(0,r.Q3)("",!0)])))),128)),(0,r.Lk)("tr",null,[e[12]||(e[12]=(0,r.Lk)("td",{colspan:"3",style:{"text-align":"right"}},"รวมหน่วยกิต:",-1)),(0,r.Lk)("td",sr,(0,n.v_)(o.totalCreditsChangeData[s]?.totalCredits),1)])])])])])])])))),128)),(0,r.Lk)("button",{onClick:e[3]||(e[3]=(...t)=>o.goBack&&o.goBack(...t)),class:"btn btn-back"},e[14]||(e[14]=[(0,r.Lk)("i",{class:"fa-solid fa-arrow-left-long"},null,-1),(0,r.eW)(" กลับ")])),(0,r.Lk)("div",ar,[(0,r.Lk)("div",null,[(0,r.Lk)("button",{class:"btn-remove",style:{"font-size":"18px",width:"150px"},onClick:e[4]||(e[4]=(...t)=>o.openRejectPopup&&o.openRejectPopup(...t))},e[15]||(e[15]=[(0,r.Lk)("i",{class:"fa-solid fa-xmark"},null,-1),(0,r.eW)(" ปฏิเสธ ")]))]),(0,r.Lk)("button",{class:"btn-add",style:{"font-size":"18px","background-color":"#02bd2a","margin-left":"20px",width:"150px"},onClick:e[5]||(e[5]=(...t)=>o.submitPlan&&o.submitPlan(...t))},e[16]||(e[16]=[(0,r.Lk)("i",{class:"fa-solid fa-check"},null,-1),(0,r.eW)(" เห็นชอบ ")]))])])),_:1})}var lr={setup(){const t=(0,r.WQ)("user"),e=(0,r.EW)((()=>t?.value||{}));return console.log("User Data:",e.value),{user:e}},name:"tc_inspect_adjust",components:{MainLayout:f},data(){return{std_id:this.$route.query.std_id,std_name:this.$route.query.std_name,std_last:this.$route.query.std_last,year:this.$route.query.year,adjust_id:this.$route.query.adjust_id,ori_data:[],change_data:[],temp_change_data:[],showRejectPopup:!1,rejectReason:""}},computed:{groupedOriData(){return this.groupPlans(this.ori_data)},groupedChangeData(){return this.groupPlans(this.temp_change_data)},totalCreditsOriData(){return this.calculateTotalCredits(this.groupedOriData)},totalCreditsChangeData(){return this.calculateTotalCredits(this.groupedChangeData)}},methods:{async fetchStudent_plan(){try{const t=await U.A.post("http://127.0.0.1:3000/api/getStudentplan_list",{std_id:this.std_id});"1"===t.data.result&&(this.ori_data=t.data.datalist)}catch(t){console.error("Error fetching subjects:",t)}},async fetchChange_plan(){try{const t=await U.A.post("http://127.0.0.1:3000/api/getAdjust_plan",{adjust_id:this.adjust_id});if("1"===t.data.result){this.change_data=t.data.datalist;let e=this.mergeDataWithChanges(this.ori_data,this.change_data);this.temp_change_data=e}}catch(t){console.error("Error fetching change plan:",t)}},mergeDataWithChanges(t,e){let s=[...t];return e.forEach((t=>{const e=s.findIndex((e=>e.subject_id===t.subject_id));-1!==e?s[e]={...t,hasChanges:!0}:s.push({...t,hasChanges:!0})})),s},checkHasChanges(t){const e=this.temp_change_data.find((e=>e.subject_id===t.subject_id&&e.term===t.term&&e.year===t.year));return!e||JSON.stringify(e)!==JSON.stringify(t)},groupPlans(t){const e=new Set(t.map((t=>`${t.year}-${t.term}`)));return Array.from(e).map((t=>t.split("-").map(Number))).sort(((t,e)=>t[0]-e[0]||t[1]-e[1])).map((([e,s])=>{const a=t.filter((t=>t.year===e&&t.term===s)).sort(((t,e)=>t.group_id.localeCompare(e.group_id)));return{yearTerm:`${e}-${s}`,year:e,term:3===s?"ภาคฤดูร้อน":s,plans:a}}))},calculateTotalCredits(t){return t.map((t=>{const e=t.plans.reduce(((t,e)=>{const s=Number(e.theory_credits)||0,a=Number(e.practical_credits)||0;return t+(s+a)}),0);return{...t,totalCredits:e}}))},async submitPlan(){if(confirm("ต้องการยืนยันผลของแผนการเรียนนี้ใช่หรือไม่"))try{const t=await U.A.post("http://127.0.0.1:3000/api/updateAdjust_plan",{std_id:this.std_id,adjust_id:this.adjust_id,plans:this.change_data,user:this.user.user_name,status:1});"1"===t.data.result&&(this.change_data=t.data.datalist,this.$router.go(-1))}catch(t){console.error("Error fetching change plan:",t)}},openRejectPopup(){this.showRejectPopup=!0},closeRejectPopup(){this.showRejectPopup=!1},async rejectPlan(){if(confirm("ต้องการยืนยันผลของแผนการเรียนนี้ใช่หรือไม่"))try{const t=await U.A.post("http://127.0.0.1:3000/api/updateAdjust_plan",{std_id:this.std_id,adjust_id:this.adjust_id,plans:this.change_data,user:this.user.user_name,reason:this.rejectReason,status:2});"1"===t.data.result&&(this.change_data=t.data.datalist,this.$router.go(-1))}catch(t){console.error("Error fetching change plan:",t)}},goBack(){this.$router.go(-1)}},mounted(){this.fetchStudent_plan().then((()=>{this.fetchChange_plan()}))}};const ir=(0,g.A)(lr,[["render",rr]]);var nr=ir;const or={class:"subject-table-page",style:{}},cr=["value"],ur={key:0,style:{"margin-bottom":"200px"}},dr={class:"data-stdplan-table"},_r={key:0},pr={colspan:"7",style:{"font-weight":"bold","text-align":"left"}},hr=["rowspan"],yr=["rowspan"],kr=["rowspan"],br={key:1};function gr(t,e,s,l,i,o){const c=(0,r.g2)("MainLayout");return(0,r.uX)(),(0,r.Wv)(c,null,{default:(0,r.k6)((()=>[(0,r.Lk)("div",or,[e[7]||(e[7]=(0,r.Lk)("br",null,null,-1)),e[8]||(e[8]=(0,r.Lk)("h1",null,"รายงานแผนการเรียนประจำภาคเรียน",-1)),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>i.select_year=t),style:{"font-size":"20px"}},[e[2]||(e[2]=(0,r.Lk)("option",{value:"",disabled:""},"เลือกรุ่นปีการศึกษา",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.year,(t=>((0,r.uX)(),(0,r.CE)("option",{key:t,value:t},(0,n.v_)(t),9,cr)))),128))],512),[[a.u1,i.select_year]]),i.student_data.length?((0,r.uX)(),(0,r.CE)("div",ur,[e[5]||(e[5]=(0,r.Lk)("h2",null,"แผนการเรียนรายวิชาประจำภาคเรียน",-1)),(0,r.Lk)("table",dr,[e[3]||(e[3]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",{style:{width:"120px"}},"รหัสวิชา"),(0,r.Lk)("th",null,"ชื่อวิชา"),(0,r.Lk)("th",null,"หน่วยกิต"),(0,r.Lk)("th",null,"ปีการศึกษา"),(0,r.Lk)("th",null,"เทอม"),(0,r.Lk)("th",null,"จำนวนนักศึกษา")])],-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.group_list,(t=>((0,r.uX)(),(0,r.CE)(r.FK,{key:"g"+t.group_id},[o.tableRows.some((e=>e.group_id===t.group_id))?((0,r.uX)(),(0,r.CE)("tbody",_r,[(0,r.Lk)("tr",null,[(0,r.Lk)("td",pr,(0,n.v_)(t.group_id)+" "+(0,n.v_)(t.group_name),1)]),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.tableRows.filter((e=>e.group_id===t.group_id)),(t=>((0,r.uX)(),(0,r.CE)("tr",{key:t.subject_id+"-"+t.term},[t.showHead?((0,r.uX)(),(0,r.CE)("td",{key:0,rowspan:t.rowspan,style:{"vertical-align":"top"}},(0,n.v_)(t.subject_id),9,hr)):(0,r.Q3)("",!0),t.showHead?((0,r.uX)(),(0,r.CE)("td",{key:1,rowspan:t.rowspan,style:{"vertical-align":"top","text-align":"left"}},(0,n.v_)(t.subject_name),9,yr)):(0,r.Q3)("",!0),t.showHead?((0,r.uX)(),(0,r.CE)("td",{key:2,rowspan:t.rowspan,style:{"vertical-align":"top"}},(0,n.v_)(t.practical_credits+t.theory_credits),9,kr)):(0,r.Q3)("",!0),(0,r.Lk)("td",null,(0,n.v_)(3===t.year?i.select_year:Number(i.select_year)+1),1),(0,r.Lk)("td",null,(0,n.v_)(t.term),1),(0,r.Lk)("td",null,(0,n.v_)(t.total_student),1)])))),128))])):(0,r.Q3)("",!0)],64)))),128))]),(0,r.Lk)("button",{class:"btn-back",style:{"font-size":"16px","background-color":"#00cc00",width:"200px"},onClick:e[1]||(e[1]=(...t)=>o.openPreviewWindow&&o.openPreviewWindow(...t))},e[4]||(e[4]=[(0,r.Lk)("i",{class:"fa-solid fa-file-pdf"},null,-1),(0,r.eW)(" พิมพ์รายงาน ")]))])):(0,r.Q3)("",!0),i.student_data.length?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",br,e[6]||(e[6]=[(0,r.Lk)("h2",null,"กรุณาเลือกรุ่นปีการศึกษา",-1)])))])])),_:1})}var mr={name:"tc_summery_plan",components:{MainLayout:f},data(){return{year:[],select_year:"",students:[],student_data:[],structure:[],student_plan:[],open_subject:[],group_list:[],std_open_subject:[]}},computed:{tableRows(){const t=Object.fromEntries(this.group_list.map((t=>[t.group_id,t.group_name]))),e=[],s=this.std_open_subject.slice().sort(((t,e)=>t.group_id-e.group_id||t.subject_id.localeCompare(e.subject_id)||t.term-e.term));let a=0;while(a<s.length){const r=s[a],l=s.filter((t=>t.group_id===r.group_id&&t.subject_id===r.subject_id)),i=l.length;l.forEach(((s,a)=>{e.push({...s,group_name:t[s.group_id]||"",showHead:0===a,rowspan:0===a?i:0})})),a+=i}return e}},methods:{async fetchStudent_list(){try{const t=await U.A.get("http://127.0.0.1:3000/api/getStudent_plan");"1"===t.data.result&&(console.log(t.data.datalist),this.students=t.data.datalist,this.extract_year())}catch(t){console.error("Error fetching student data:",t)}},extract_year(){const t=this.students.map((t=>t.batch_year));this.year=[...new Set(t)].sort(((t,e)=>e-t))},extract_students_by_year(){const t=this.students.filter((t=>t.batch_year===this.select_year&&1===t.status));this.student_data=t,this.fetchStudent_plan()},async fetchStudent_plan(){const t=this.student_data.map((t=>t.std_id));this.student_plan=[];for(let s=0;s<t.length;s++)try{const e=await U.A.post("http://127.0.0.1:3000/api/getStudentplan_list",{std_id:t[s]});"1"===e.data.result?this.student_plan.push(...e.data.datalist):"0"===e.data.result&&(this.student_plan=[])}catch(e){console.error("Error fetching subjects:",e)}this.gen_student_subject()},async fetchStructure(){try{const t=await U.A.get("http://127.0.0.1:3000/api/getStructure",{});this.group_list=t.data.datalist}catch(t){console.error("Error fetching subject:",t)}},async fetchOpen_subject(){console.log(this.selectGroup);try{const t=await U.A.post("http://127.0.0.1:3000/api/getopensubject",{});"1"==t.data.result?(this.open_subject=t.data.datalist,this.groupPlans()):"2"==t.data.result&&(this.open_subject=[],this.groupPlans())}catch(t){console.error("Error fetching subject:",t)}},gen_student_subject(){this.std_open_subject=[];const t={};this.open_subject.forEach((e=>{const s=`${e.subject_id}|${e.term}`;t[s]||(t[s]=e)}));const e={};this.student_plan.forEach((s=>{const a=`${s.subject_id}|${s.term}`;if(!t[a])return;const r=`${s.subject_id}|${s.term}|${s.year}`;e[r]=(e[r]||0)+1}));let s=1;this.std_open_subject=Object.keys(e).map((a=>{const[r,l,i]=a.split("|"),n=t[`${r}|${l}`];return{no:s++,subject_id:r,subject_name:n.subject_name,theory_credits:n.theory_credits,practical_credits:n.practical_credits,year:Number(i),term:Number(l),total_student:e[a],group_id:n.group_id}})),this.std_open_subject.sort(((t,e)=>t.subject_id.localeCompare(e.subject_id)||t.year-e.year||t.term-e.term))},openPreviewWindow(){const t=encodeURIComponent("รายงานแผนการเรียนประจำภาคเรียน"),e=encodeURIComponent(JSON.stringify(this.std_open_subject)),s=encodeURIComponent(JSON.stringify(this.group_list)),a=`http://127.0.0.1:3000/api/pdf_summery_plan?title=${t}&students_plan=${e}&group=${s}&year=${this.select_year}`;window.open(a,"_blank")}},watch:{select_year(t){console.log("Selected year:",t),this.extract_students_by_year()}},mounted(){this.fetchStudent_list(),this.fetchStructure(),this.fetchOpen_subject()}};const fr=(0,g.A)(mr,[["render",gr]]);var Lr=fr;const vr={class:"subject-table-page"},Cr=["value"],jr={key:0},Er={class:"data-stdplan-table"},wr={style:{"text-align":"left"}},Sr={key:1};function xr(t,e,s,l,i,o){const c=(0,r.g2)("MainLayout");return(0,r.uX)(),(0,r.Wv)(c,null,{default:(0,r.k6)((()=>[(0,r.Lk)("div",vr,[e[7]||(e[7]=(0,r.Lk)("br",null,null,-1)),e[8]||(e[8]=(0,r.Lk)("h1",null,"รายงานผลการเทียบโอน",-1)),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>i.select_year=t),style:{"font-size":"20px"}},[e[2]||(e[2]=(0,r.Lk)("option",{value:"",disabled:""},"เลือกรุ่นปีการศึกษา",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.year,(t=>((0,r.uX)(),(0,r.CE)("option",{key:t,value:t},(0,n.v_)(t),9,Cr)))),128))],512),[[a.u1,i.select_year]]),i.student_data.length?((0,r.uX)(),(0,r.CE)("div",jr,[(0,r.Lk)("h2",null,"รายชื่อนักศึกษาปี "+(0,n.v_)(i.select_year),1),(0,r.Lk)("table",Er,[e[4]||(e[4]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",null,"รหัสนักศึกษา"),(0,r.Lk)("th",null,"ชื่อ-นามสกุล"),(0,r.Lk)("th",null,"หน่วยกิตบังคับ"),(0,r.Lk)("th",null,"เทียบโอนได้"),(0,r.Lk)("th",null,"เรียนเพิ่ม")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.student_data,(t=>((0,r.uX)(),(0,r.CE)("tr",{key:t.std_id},[(0,r.Lk)("td",null,(0,n.v_)(t.std_id),1),(0,r.Lk)("td",wr,(0,n.v_)(t.std_name)+" "+(0,n.v_)(t.std_last),1),e[3]||(e[3]=(0,r.Lk)("td",null,"125",-1)),(0,r.Lk)("td",null,(0,n.v_)(t.total_Tcredits),1),(0,r.Lk)("td",null,(0,n.v_)(t.total_Pcredits),1)])))),128))])]),(0,r.Lk)("button",{class:"btn-back",style:{"font-size":"16px","background-color":"#00cc00",width:"200px"},onClick:e[1]||(e[1]=(...t)=>o.openPreviewWindow&&o.openPreviewWindow(...t))},e[5]||(e[5]=[(0,r.Lk)("i",{class:"fa-solid fa-file-pdf"},null,-1),(0,r.eW)(" พิมพ์รายงาน ")]))])):(0,r.Q3)("",!0),i.student_data.length?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",Sr,e[6]||(e[6]=[(0,r.Lk)("h2",null,"กรุณาเลือกรุ่นปีการศึกษา",-1)])))])])),_:1})}var Xr={name:"tc_summery_tranfer",components:{MainLayout:f},data(){return{year:[],select_year:"",students:[],student_data:[],tranfer_list:[],student_plan:[]}},computed:{filteredStudents(){return this.students.filter((t=>t.batch_year===this.select_year&&1===t.status))}},methods:{async fetchStudent_list(){try{const t=await U.A.get("http://127.0.0.1:3000/api/getStudent_plan");"1"===t.data.result&&(console.log(t.data.datalist),this.students=t.data.datalist,this.extract_year())}catch(t){console.error("Error fetching student data:",t)}},extract_year(){const t=this.students.map((t=>t.batch_year));this.year=[...new Set(t)].sort(((t,e)=>e-t))},extract_students_by_year(){const t=this.students.filter((t=>t.batch_year===this.select_year&&1===t.status));this.student_data=t,this.fetchTransfer_list(),this.fetchStudent_plan()},async fetchTransfer_list(){const t=this.student_data.map((t=>t.std_id));this.tranfer_list=[];for(let s=0;s<t.length;s++)try{const e=await U.A.post("http://127.0.0.1:3000/api/getTranfer_plan",{std_id:t[s]});if("1"==e.data.result){const a=e.data.datalist,r=a.reduce(((t,e)=>t+(e.theory_credits+e.practical_credits)),0),l=this.student_data.find((e=>e.std_id===t[s]));l&&(l.total_Tcredits=r)}else e.data.result}catch(e){console.error("Error fetching subject:",e)}},async fetchStudent_plan(){const t=this.student_data.map((t=>t.std_id));this.student_plan=[];for(let s=0;s<t.length;s++)try{const e=await U.A.post("http://127.0.0.1:3000/api/getStudentplan_list",{std_id:t[s]});if("1"===e.data.result){const a=e.data.datalist,r=a.reduce(((t,e)=>t+(e.theory_credits+e.practical_credits)),0),l=this.student_data.find((e=>e.std_id===t[s]));l&&(l.total_Pcredits=r)}else"0"===e.data.result&&(this.student_plan=[])}catch(e){console.error("Error fetching subjects:",e)}},openPreviewWindow(){const t=encodeURIComponent("รายงานผลการเทียบโอน"),e=encodeURIComponent(JSON.stringify(this.student_data)),s=`http://127.0.0.1:3000/api/pdf_summery_tranfer?title=${t}&content=${e}&year=${this.select_year}`;window.open(s,"_blank")}},watch:{select_year(t){console.log("Selected year:",t),this.extract_students_by_year()}},mounted(){this.fetchStudent_list()}};const Pr=(0,g.A)(Xr,[["render",xr]]);var Tr=Pr;const Ar={class:"subject-table-page"},Qr=["value"],$r={key:0},Nr={class:"data-stdplan-table"},Or={style:{"text-align":"left"}},Fr=["onClick"],Ir={key:1};function qr(t,e,s,l,i,o){const c=(0,r.g2)("MainLayout");return(0,r.uX)(),(0,r.Wv)(c,null,{default:(0,r.k6)((()=>[(0,r.Lk)("div",Ar,[e[7]||(e[7]=(0,r.Lk)("br",null,null,-1)),e[8]||(e[8]=(0,r.Lk)("h1",null,"รายงานแผนการเรียนรายบุคคล",-1)),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>i.select_year=t),style:{"font-size":"20px"}},[e[2]||(e[2]=(0,r.Lk)("option",{value:"",disabled:""},"เลือกรุ่นปีการศึกษา",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.year,(t=>((0,r.uX)(),(0,r.CE)("option",{key:t,value:t},(0,n.v_)(t),9,Qr)))),128))],512),[[a.u1,i.select_year]]),i.student_data.length?((0,r.uX)(),(0,r.CE)("div",$r,[(0,r.Lk)("h2",null,"รายชื่อนักศึกษาปี "+(0,n.v_)(i.select_year),1),(0,r.Lk)("table",Nr,[e[4]||(e[4]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",null,"รหัสนักศึกษา"),(0,r.Lk)("th",null,"ชื่อ-นามสกุล"),(0,r.Lk)("th",null,"รุ่นปีการศึกษา"),(0,r.Lk)("th")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.student_data,(t=>((0,r.uX)(),(0,r.CE)("tr",{key:t.std_id},[(0,r.Lk)("td",null,(0,n.v_)(t.std_id),1),(0,r.Lk)("td",Or,(0,n.v_)(t.std_name)+" "+(0,n.v_)(t.std_last),1),(0,r.Lk)("td",null,(0,n.v_)(t.batch_year),1),(0,r.Lk)("td",null,[(0,r.Lk)("button",{class:"btn-add",style:{"font-size":"16px",width:"100px"},onClick:e=>o.inspectPlan(t.std_id,t.stdplan_id,t.status,t.std_name,t.std_last,t.batch_year)},e[3]||(e[3]=[(0,r.Lk)("i",{class:"fa-solid fa-magnifying-glass"},null,-1)]),8,Fr)])])))),128))])]),(0,r.Lk)("button",{class:"btn-back",style:{"font-size":"16px","background-color":"#00cc00",width:"200px"},onClick:e[1]||(e[1]=(...t)=>o.openPreviewWindow&&o.openPreviewWindow(...t))},e[5]||(e[5]=[(0,r.Lk)("i",{class:"fa-solid fa-file-pdf"},null,-1),(0,r.eW)(" พิมพ์รายงาน ")]))])):(0,r.Q3)("",!0),i.student_data.length?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",Ir,e[6]||(e[6]=[(0,r.Lk)("h2",null,"กรุณาเลือกรุ่นปีการศึกษา",-1)])))])])),_:1})}var Wr={name:"tc_summery_std",components:{MainLayout:f},data(){return{year:[],select_year:"",students:[],student_data:[],tranfer_list:[],student_plan:[]}},computed:{filteredStudents(){return this.students.filter((t=>t.batch_year===this.select_year&&1===t.status))}},methods:{async fetchStudent_list(){try{const t=await U.A.get("http://127.0.0.1:3000/api/getStudent_plan");"1"===t.data.result&&(console.log(t.data.datalist),this.students=t.data.datalist,this.extract_year())}catch(t){console.error("Error fetching student data:",t)}},extract_year(){const t=this.students.map((t=>t.batch_year));this.year=[...new Set(t)].sort(((t,e)=>e-t))},extract_students_by_year(){const t=this.students.filter((t=>t.batch_year===this.select_year&&1===t.status));this.student_data=t},async inspectPlan(t,e,s,a,r,l){console.log(s),s=0==s?"0":2==s?"2":3==s?"3":4==s?"4":"1",console.log(s),this.$router.push({name:"tc_inspect_plan",query:{std_id:t,stdplan_id:e,status:s,std_name:a,std_last:r,year:l}})},openPreviewWindow(){const t=this.student_data.filter((t=>1===t.status));console.log("นักศึกษาที่มี status = 1:",t);const e=1,s=encodeURIComponent("แผนการเรียนรายบุคคล"),a=encodeURIComponent(JSON.stringify(t)),r=`http://127.0.0.1:3000/api/pdf_generate?title=${s}&content=${a}&status=${e}`;window.open(r,"_blank")}},watch:{select_year(t){console.log("Selected year:",t),this.extract_students_by_year()}},mounted(){this.fetchStudent_list()}};const Gr=(0,g.A)(Wr,[["render",qr]]);var Ur=Gr;const Kr=[{path:"/",name:"homePage",component:z},{path:"/loginPage",name:"loginPage",component:et},{path:"/open_subject",name:"tc_open_subject",component:mt,meta:{requiresAuth:!0}},{path:"/data_bot",name:"tc_adddata_bot",component:xt,meta:{requiresAuth:!0}},{path:"/standard_plan",name:"tc_standard_plan",component:Wt,meta:{requiresAuth:!0}},{path:"/edit_standard_plan",name:"tc_editStandard_plan",component:he,meta:{requiresAuth:!0}},{path:"/student_plan_list",name:"tc_student_list",component:Ae,meta:{requiresAuth:!0}},{path:"/edit_student_plan",name:"tc_editStudent_plan",component:ks,meta:{requiresAuth:!0}},{path:"/submitplan",name:"tc_submitplan_list",component:Qs,meta:{requiresAuth:!0}},{path:"/inspectplan",name:"tc_inspect_plan",component:Ms,meta:{requiresAuth:!0}},{path:"/student_plan",name:"student_plan_page",component:ua,meta:{requiresAuth:!0}},{path:"/student_change_plan",name:"student_changePlan_page",component:$a,meta:{requiresAuth:!0}},{path:"/adjust_list",name:"tc_adjust_list",component:za,meta:{requiresAuth:!0}},{path:"/inspect_adjust",name:"tc_inspect_adjust",component:nr,meta:{requiresAuth:!0}},{path:"/summery_tranfer",name:"tc_summery_tranfer",component:Tr,meta:{requiresAuth:!0}},{path:"/summery_plan",name:"tc_summery_plan",component:Lr,meta:{requiresAuth:!0}},{path:"/summery_student",name:"tc_summery_std",component:Ur,meta:{requiresAuth:!0}}],Dr=(0,E.aE)({history:(0,E.LA)("/"),routes:Kr});Dr.beforeEach(((t,e,s)=>{const a=localStorage.getItem("user_data");t.meta.requiresAuth&&!a?s("/"):s()}));var Rr=Dr,zr=s(292),Jr=s(8950),Vr=s(2353);Jr.Yv.add(Vr.X7I);const Mr=(0,a.Ef)(C);Mr.config.globalProperties.$axios=U.A,Mr.use(j),Mr.use(Rr),Mr.component("font-awesome-icon",zr.gc),Mr.mount("#app")}},e={};function s(a){var r=e[a];if(void 0!==r)return r.exports;var l=e[a]={exports:{}};return t[a].call(l.exports,l,l.exports,s),l.exports}s.m=t,function(){var t=[];s.O=function(e,a,r,l){if(!a){var i=1/0;for(u=0;u<t.length;u++){a=t[u][0],r=t[u][1],l=t[u][2];for(var n=!0,o=0;o<a.length;o++)(!1&l||i>=l)&&Object.keys(s.O).every((function(t){return s.O[t](a[o])}))?a.splice(o--,1):(n=!1,l<i&&(i=l));if(n){t.splice(u--,1);var c=r();void 0!==c&&(e=c)}}return e}l=l||0;for(var u=t.length;u>0&&t[u-1][2]>l;u--)t[u]=t[u-1];t[u]=[a,r,l]}}(),function(){s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,{a:e}),e}}(),function(){s.d=function(t,e){for(var a in e)s.o(e,a)&&!s.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){s.p="/"}(),function(){var t={524:0};s.O.j=function(e){return 0===t[e]};var e=function(e,a){var r,l,i=a[0],n=a[1],o=a[2],c=0;if(i.some((function(e){return 0!==t[e]}))){for(r in n)s.o(n,r)&&(s.m[r]=n[r]);if(o)var u=o(s)}for(e&&e(a);c<i.length;c++)l=i[c],s.o(t,l)&&t[l]&&t[l][0](),t[l]=0;return s.O(u)},a=self["webpackChunkwebapp_project"]=self["webpackChunkwebapp_project"]||[];a.forEach(e.bind(null,0)),a.push=e.bind(null,a.push.bind(a))}();var a=s.O(void 0,[504],(function(){return s(8421)}));a=s.O(a)})();
//# sourceMappingURL=app.a1e52d2f.js.map